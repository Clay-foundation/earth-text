import numpy as np
import pandas as pd
from loguru import logger
import torch
from torch.utils.data import Dataset
from progressbar import progressbar as pbar
from earthtext.io import io
import matplotlib.pyplot as plt
import geopandas as gpd
torch.multiprocessing.set_sharing_strategy('file_system')

esawc_map = {
'10':	'Tree cover',
'20':	'Shrubland',
'30':	'Grassland',
'40':	'Cropland',
'50':	'Built-up',
'60':	'Bare / sparse vegetation',
'70':	'Snow and ice',
'80':	'Permanent water bodies',
'90':	'Herbaceous wetland',
'95':	'Mangroves',
'100':'Moss and lichen'
}


embeddings_mean = np.array([-9.39538796e-03,  1.12288393e-01, -2.34312750e-02,  3.45812887e-02,
       -8.65198206e-03,  3.93303856e-02,  3.92309669e-03, -1.76956970e-02,
        2.51247548e-02, -2.86636036e-02,  3.54696065e-03,  6.25329092e-02,
       -2.90845744e-02,  2.07681325e-03,  5.49030118e-03, -7.66349733e-02,
       -1.67570487e-02, -4.00171041e-01,  3.88672538e-02, -3.50190252e-02,
        3.36555555e-03,  1.90525893e-02,  5.33463955e-02,  3.58631536e-02,
       -3.42778489e-02, -1.43365590e-02,  2.92303332e-04,  6.35980722e-03,
       -6.98423618e-03,  5.76189533e-03,  4.15735729e-02,  4.82837968e-02,
       -7.59365456e-03, -2.30203718e-02,  8.91984673e-04, -4.39613452e-03,
       -3.82513627e-02,  1.05046891e-02,  1.37824826e-02,  7.56102731e-04,
       -5.54584488e-02,  1.01540880e-02, -7.60225579e-03,  1.25459826e-03,
       -3.28117386e-02,  4.28506266e-03,  4.53595929e-02,  3.25362645e-02,
        2.46527791e-03, -3.38467071e-03,  7.99778849e-03,  3.93529236e-03,
       -1.74317707e-03, -4.66960855e-03, -6.09813482e-02, -6.88451529e-02,
       -1.15637132e-03,  9.29022953e-02, -8.63902494e-02,  3.27485204e-02,
       -6.32854179e-04, -1.71969086e-03, -1.09194862e-02,  5.07790968e-03,
       -5.17693833e-02, -6.80176402e-03,  3.32681760e-02, -1.32268071e-02,
       -1.03373025e-02, -1.47949602e-03, -4.09346685e-04,  2.17322931e-02,
        3.60938394e-03, -2.98765767e-03, -1.03556113e-02, -4.23425203e-03,
       -1.45435426e-02, -5.61986351e-03, -3.00304336e-03, -1.52934864e-02,
       -3.74392327e-03,  2.17621564e-03, -1.25116738e-03, -3.34246233e-02,
        1.83730014e-02,  1.19590079e-02, -2.80964130e-04,  1.26439880e-03,
        1.85106564e-02, -2.25347225e-02, -6.81891013e-03,  9.66131687e-03,
        2.94851623e-02, -9.78662792e-05, -2.31348025e-03, -3.47342156e-03,
        5.44777373e-04,  3.62198730e-03, -6.12408668e-02,  2.97111794e-02,
       -2.06879107e-03,  6.31065853e-03, -1.14525137e-02,  4.43281839e-03,
        1.13981208e-02,  1.93084981e-02, -1.99227966e-03, -1.14583828e-01,
       -4.03072219e-04, -8.60476110e-04,  4.39650659e-03,  2.32870299e-02,
       -2.33639567e-03, -2.06906237e-02,  2.29889825e-02, -5.50120254e-04,
       -2.25223787e-02,  3.48964967e-02,  2.14777030e-02, -6.94879293e-02,
        1.06551135e-02, -1.04168896e-02, -4.93504070e-02, -3.48994732e-02,
        8.90766755e-02,  2.30892226e-02, -2.83708912e-03,  8.01819656e-03,
       -1.46981537e-01,  3.92031763e-03, -2.01206072e-03,  4.59543020e-02,
        3.17302742e-03,  6.93514720e-02, -9.31166403e-04,  5.45353396e-03,
        7.60042444e-02,  4.19931224e-04,  1.67464074e-02, -3.46156739e-04,
       -1.26044508e-02,  3.48618976e-03, -7.78018218e-03, -2.16877717e-03,
        1.37769552e-02, -2.26784497e-03, -5.61588705e-02, -6.41071936e-03,
        2.29514856e-02, -7.67307822e-03, -3.62113421e-03, -4.45391145e-03,
       -1.47374235e-02, -4.17297557e-02,  6.48869155e-03,  9.93071240e-04,
        2.59134881e-02,  2.41941810e-02,  1.17733260e-03, -1.36267487e-02,
        4.33295919e-03,  1.40340766e-02,  6.34385599e-03, -9.75572318e-03,
        3.76927643e-03,  6.17005266e-02, -8.26341286e-03,  3.05017782e-03,
        7.58836418e-02,  7.04587018e-03,  7.31890202e-02,  2.58456287e-03,
       -2.27159578e-02, -1.50414594e-02,  3.69976304e-04, -6.76884642e-03,
       -3.09012178e-03, -4.49656462e-03,  7.02114264e-03, -4.78876829e-02,
       -1.71159748e-02, -4.67419140e-02, -1.24774082e-02,  1.05651766e-02,
        1.47196073e-02,  1.94249023e-02,  1.25146424e-03,  2.21791398e-02,
        3.14516686e-02, -2.13323534e-02,  1.32609047e-02, -1.04511660e-02,
       -8.82300490e-04, -6.62303641e-02,  9.05106366e-02,  1.37215834e-02,
       -2.44440883e-02,  4.61360114e-03, -4.10705432e-03,  4.54600565e-02,
       -2.91878195e-03,  2.92082434e-03,  6.43361732e-02, -8.08420591e-03,
        1.15803443e-02, -6.16412261e-04,  1.85717910e-03, -4.62450795e-02,
       -1.30635276e-02, -5.43663837e-03,  1.06227687e-02,  1.10694366e-02,
       -3.46282050e-02,  2.75492878e-03, -6.12751506e-02, -2.13571098e-02,
       -5.55839725e-02, -8.78499225e-02, -9.38321755e-04, -2.30663267e-04,
       -7.61087053e-04, -7.32475237e-05, -5.48553560e-03, -2.22686818e-03,
        2.13337511e-01,  1.02071054e-01, -1.58721104e-01,  1.83747523e-03,
        2.48707701e-02,  2.10557482e-03, -5.99809252e-02,  8.32797736e-02,
        5.67618804e-03, -2.83906255e-02, -4.50470624e-03,  1.54949250e-02,
        8.12710077e-03,  6.33936282e-03,  1.29460916e-01, -8.59841798e-03,
       -4.36730310e-03, -7.64177591e-02, -7.52383232e-01, -2.35836934e-02,
        4.20192480e-01, -1.76606774e-02, -1.63781850e-04, -4.32741828e-03,
       -4.51579988e-02, -6.50035590e-02,  1.70331600e-03, -1.51321513e-03,
        2.40483205e-03, -2.35404121e-03, -3.57708521e-02,  1.22547208e-03,
       -3.68173904e-04,  3.16965021e-03,  8.96108989e-03,  1.35536934e-03,
        1.23734120e-02,  7.68885342e-03, -1.25871032e-01, -7.42036849e-04,
       -1.40417084e-01,  1.92287732e-02, -2.16396879e-02,  4.69731027e-03,
        2.90215807e-03,  1.89341195e-02, -4.12820727e-02,  8.29608273e-03,
        3.95215256e-03,  1.96523085e-01,  1.00448998e-02, -1.41174197e-01,
       -2.24414136e-04,  1.58836730e-02, -1.83667173e-03,  2.30912236e-03,
       -2.77606491e-02,  4.23966069e-03, -2.92774830e-02, -9.07408912e-03,
       -1.84656790e-04,  3.11870202e-02,  3.99118871e-04,  2.48347707e-02,
        8.58969241e-03, -1.46939559e-03,  1.03027122e-02, -2.96666613e-03,
        1.49116702e-02,  1.13266138e-02,  1.16294893e-02,  2.39229048e-04,
        1.04156472e-02, -4.27681208e-03, -2.10893974e-02, -1.81678370e-01,
        2.43766643e-02,  2.95073986e-02,  1.62834045e-03, -1.70575351e-01,
       -2.49749399e-03, -2.78110243e-02,  6.23720624e-02, -1.86840701e-03,
       -5.10343816e-03, -6.45193383e-02,  3.08682956e-02,  1.71893016e-02,
       -6.69717090e-03,  7.77670555e-03,  5.42565249e-03,  1.34050567e-03,
       -7.28494255e-03, -2.32503237e-03,  4.93120775e-03, -2.67931027e-03,
       -3.60137038e-02, -1.59746241e-02, -7.06547722e-02, -1.11913041e-03,
       -3.55084729e-03,  1.53265875e-02,  1.56839825e-02, -5.20169437e-02,
       -1.87166110e-02, -9.51466803e-03, -1.90008786e-02,  3.09732594e-02,
        1.00848809e-01,  1.68391224e-02,  2.00382285e-02, -3.82952914e-02,
       -2.35828776e-02,  3.82709131e-03, -3.92442197e-02,  5.00040920e-03,
        2.29762364e-02,  2.92610470e-02,  8.55311658e-03, -1.70326941e-02,
        1.45713864e-02,  5.68237603e-02,  2.52696213e-06,  3.07259969e-02,
        4.27676784e-03, -5.40115312e-02, -1.10673973e-04,  9.40375775e-03,
        1.45478977e-03,  3.12278941e-02,  1.93850808e-02,  5.69422804e-02,
        5.56347938e-03,  1.22518197e-03, -2.36669905e-03, -4.70617414e-02,
       -4.63459524e-04,  2.22082064e-02,  1.00870505e-02,  7.39530660e-04,
       -1.41519597e-02, -5.47791310e-02,  4.60395869e-03, -1.59329618e-03,
       -3.28751979e-03, -5.54489496e-04, -3.58617515e-03,  1.85278635e-02,
       -4.50047031e-02,  1.61687681e-03,  4.78929002e-03,  2.37856265e-02,
        3.20681669e-02,  7.50587042e-03,  4.13065962e-03, -4.36613373e-02,
        3.72059420e-02, -6.92185108e-03,  1.07058967e-02,  1.64731708e-03,
        2.26059626e-03, -1.81981977e-02,  3.45890969e-03,  9.90388729e-03,
       -6.47455975e-02,  6.21307554e-05,  2.50608400e-02,  1.33374017e-02,
        3.42940539e-02,  1.68459453e-02,  8.68205447e-03,  4.20962600e-03,
        4.01870767e-03,  1.17309159e-03,  2.14597937e-02, -3.04662865e-02,
       -2.09046546e-02,  8.09910521e-03, -1.33613385e-02,  1.30188465e-01,
        6.14705123e-03, -3.43168765e-01,  1.03803622e-02, -5.45193302e-03,
        1.12526072e-02,  8.23511090e-03,  4.75206086e-03, -9.59133543e-03,
        7.45951757e-03,  2.22521760e-02,  2.20489018e-02, -1.88433344e-03,
       -7.84953649e-04, -3.22897104e-03,  1.17962211e-02,  3.63314416e-06,
       -3.30383964e-02, -5.18388042e-05, -1.77233655e-03,  2.49943696e-03,
       -3.46921273e-02,  1.25720892e-02,  2.29983777e-03,  3.19545493e-02,
       -1.64548326e-02,  6.51347777e-03,  4.94265184e-03, -3.98821421e-02,
        1.34472502e-03, -1.45944163e-01, -2.29775663e-02, -2.22010594e-02,
       -2.45911051e-02, -3.02722212e-02, -1.70588791e-02, -7.35756150e-03,
       -6.60157902e-03,  1.75483024e-03,  3.81325036e-02, -4.09725048e-02,
       -7.18112802e-03,  1.09815807e-03,  1.78140644e-02,  6.29718080e-02,
        1.59075111e-02, -1.01172917e-01, -2.78716199e-02,  7.02238232e-02,
        8.16155982e-04,  3.69938603e-03, -2.21219677e-02, -6.40897686e-03,
       -6.57947152e-04, -2.79172929e-03,  3.36888582e-02,  8.21700245e-02,
       -6.23623747e-03,  2.38935743e-03, -3.51905152e-02,  2.56439857e-02,
        5.75735903e-05, -2.66265888e-02, -1.10865332e-01, -5.67295402e-03,
       -4.18956485e-03,  1.69193640e-03,  9.12398379e-03,  9.08636313e-04,
       -4.76869661e-03,  1.47084057e-01,  4.92941774e-03, -1.10012374e-03,
        1.14829130e-02, -7.51110679e-03,  3.80885764e-03, -4.00984846e-03,
        7.55313598e-03,  1.37144746e-03, -9.63603333e-02,  1.39131369e-02,
       -7.22647905e-02, -2.18145493e-02, -6.02141302e-03,  3.86221334e-04,
       -3.97391915e-02, -1.50954090e-02, -2.33353842e-02,  6.90541929e-03,
       -8.77015945e-03, -1.55309327e-02, -1.71895828e-02,  6.40830956e-03,
        1.09139998e-02,  1.10577047e-03,  1.30761219e-02, -1.82354942e-01,
        8.98150261e-03,  2.13403795e-02, -4.82119359e-02, -8.34582548e-04,
       -1.41749009e-02, -5.85273579e-02, -2.64091957e-02,  5.65004442e-03,
       -5.23082446e-03,  1.83726884e-02,  2.29642708e-02,  1.87555719e-02,
       -2.54721745e-05,  8.96740612e-03, -1.01178105e-03, -2.58209314e-02,
        3.00256647e-02, -1.40629224e-02,  1.41191087e-03, -2.06942007e-01,
       -3.27533274e-03,  7.38768978e-03,  2.56117098e-02,  9.00932821e-04,
       -1.56147005e-02,  5.12159476e-03,  6.86810724e-03, -1.05184019e-02,
        3.72628309e-02,  2.63420795e-03, -1.69865042e-02, -5.33183292e-03,
       -2.06118841e-02,  1.08711002e-02,  1.59798544e-02,  5.31771779e-03,
       -2.80692391e-02, -5.66903222e-03, -1.51475847e-01,  1.79374497e-02,
       -2.76599806e-02,  5.36425449e-02,  9.61976126e-03, -4.69042696e-02,
        1.32140703e-02,  9.03643295e-03,  6.77738804e-03,  2.21213382e-02,
       -4.04516933e-03, -1.96518246e-04,  5.87943476e-03,  3.08001949e-03,
       -1.09124407e-02, -6.69006957e-03, -7.08190631e-03,  4.94584534e-03,
       -1.12375617e+00, -2.88056098e-02, -1.26531366e-02, -2.17927359e-02,
       -3.67947929e-02, -1.24334497e-02, -1.88401788e-02, -2.18269601e-02,
       -2.95933126e-03, -5.52909123e-03,  2.17658971e-02,  5.98389544e-02,
        5.06863138e-03, -9.68444124e-02, -1.40151000e-02,  8.72249249e-03,
        2.06108161e-04, -5.64782834e-03, -4.32661222e-03,  1.88966207e-02,
        1.79423485e-03,  1.41544774e-01, -4.60208878e-02, -4.17052209e-02,
        2.95090705e-01,  8.17030594e-02,  1.51073756e-02, -9.63218976e-03,
       -4.15636832e-03,  2.38456135e-03, -1.81854874e-01, -4.32497263e-02,
        1.84977632e-02,  2.55077332e-03, -7.60359736e-03,  3.48778181e-02,
       -1.34539197e-03,  7.05847796e-03, -6.94765337e-03, -7.01355562e-02,
        9.89589188e-03, -9.14194097e-04, -4.71839339e-01, -6.56734128e-03,
        6.88517117e-04, -2.64389906e-02,  4.67487657e-03,  3.57001810e-03,
       -1.59230568e-02,  6.57510459e-02,  5.11413552e-02,  2.18950529e-02,
       -6.07563555e-02, -3.69259436e-03,  2.65674628e-02, -4.97849251e-04,
       -4.08464856e-02, -6.27224520e-03,  2.09595952e-02,  1.18781580e-03,
        1.42370712e-03,  3.73321096e-03,  1.53298192e-02,  6.91406250e-01,
       -5.52928941e-06,  2.94166920e-03,  4.92788292e-02,  3.61383776e-03,
       -1.30546382e-02,  3.14786588e-03, -7.38455635e-03,  6.88506616e-03,
       -1.90790482e-02,  1.10633718e-02, -3.74315530e-02,  1.49066458e-02,
       -2.46245833e-03, -1.81933343e-02,  5.20241819e-03,  3.27049121e-02,
       -7.39534572e-03,  1.97572634e-02,  2.12923363e-02,  7.73861306e-03,
       -1.15701519e-02, -2.90015399e-01, -1.25495475e-02,  8.61904472e-02,
        1.01650814e-02,  1.32973986e-02,  2.98634893e-03, -9.44576878e-03,
        1.20609987e-03,  4.76458436e-03, -2.14891192e-02,  1.58255789e-02,
       -1.29486760e-02, -4.11128588e-02, -4.54028370e-03, -2.08714474e-02,
        1.23674003e-02,  1.49467243e-02,  3.06624360e-02, -1.22713773e-02,
        6.87190175e-01,  1.04954001e-02, -4.14154213e-03, -4.73124353e-04,
       -1.60800274e-02,  1.98171120e-02,  5.90509386e-04, -3.31426552e-03,
       -1.46260514e-04, -2.68086214e-02, -3.39850923e-03,  6.16663434e-02,
        1.38197988e-02, -7.31518213e-03, -6.96711009e-03, -1.05976779e-02,
       -1.28046069e-02,  2.97861278e-01, -6.46228716e-02,  8.56529847e-02,
       -1.56676304e-02,  9.90874041e-03, -2.04375163e-02,  1.74640014e-03,
       -1.90839425e-01, -5.59131987e-03, -3.90143064e-03,  4.58321422e-02,
        2.38654390e-03,  5.66122355e-03,  3.55622265e-03,  4.25688131e-03,
       -9.06017050e-03,  1.74358431e-02,  3.23513187e-02, -1.88044254e-02,
        4.22557369e-02,  9.50656645e-03, -2.45368993e-03, -8.28890130e-04,
       -8.83949734e-03,  5.01065841e-03, -1.74300391e-02,  2.68392079e-02,
       -1.82923004e-02, -5.34800114e-03,  2.92647863e-03, -2.25698808e-03,
        7.29957689e-03, -6.66562002e-03,  1.42492265e-01,  3.54068168e-03,
        2.62716413e-03, -5.51084895e-03,  2.47666761e-02, -2.60019153e-02,
        1.22144017e-02, -3.91802611e-03, -6.01732321e-02, -1.98775902e-03,
       -5.01746545e-03, -2.84916516e-02,  2.95033827e-02, -3.37110390e-03,
       -1.01300202e-01,  1.57226324e-02, -2.66338363e-02, -5.08699752e-03,
        2.78195351e-01, -1.21834753e-02, -8.13234970e-03,  1.71832740e-02,
       -4.12950147e-04,  4.69680652e-02,  2.23056022e-02,  5.14364708e-03,
       -2.23053474e-04,  1.76860357e-03, -1.27132554e-02,  3.91079932e-02,
        1.05290618e-02, -7.93631002e-03, -4.79535520e-04,  1.26955018e-03,
        4.21864446e-03,  3.50380354e-02,  2.57286709e-02,  5.87105975e-02,
       -1.12462521e-03,  2.25300174e-02, -8.86302292e-02,  1.45274289e-02,
        2.09430568e-02, -7.18761003e-04, -2.06365759e-04,  6.37836661e-03,
       -2.34284811e-02, -6.48123398e-02, -1.49121238e-02, -8.53671227e-03,
        2.27291677e-02, -3.69470082e-02,  1.70565788e-02,  3.30163799e-02,
        1.52136374e-03, -5.89269819e-03, -2.46158198e-01, -1.72395073e-02])

embeddings_stdev = np.array([3.80319194e-03, 6.75820559e-03, 1.20279961e-03, 2.76107970e-03,
       2.77649960e-03, 5.91579080e-03, 3.29828332e-03, 4.61828662e-03,
       1.26900906e-02, 8.32413044e-03, 4.04373137e-03, 4.48979018e-03,
       4.57320875e-03, 1.04155648e-03, 3.43615818e-03, 8.35063867e-03,
       5.10963285e-03, 2.40471214e-02, 3.31288413e-03, 5.58817759e-03,
       4.03307192e-03, 3.85749480e-03, 1.99777447e-03, 2.37547001e-03,
       4.28759959e-03, 3.04351933e-03, 2.36571970e-04, 2.40747584e-03,
       1.75279076e-03, 2.13856623e-03, 4.74593462e-03, 1.07392864e-02,
       1.00329216e-03, 3.94904008e-03, 8.77838349e-04, 5.78019826e-04,
       3.41719552e-03, 1.04731228e-03, 3.55111505e-03, 1.90649676e-04,
       1.73861310e-02, 9.34961718e-04, 1.33745093e-03, 3.89486225e-03,
       9.05228872e-03, 3.64972372e-03, 3.19074653e-03, 1.05386106e-02,
       1.36474222e-02, 2.08220351e-03, 3.35918274e-03, 3.70709400e-04,
       5.83560846e-04, 2.48446275e-04, 1.45319439e-02, 1.22952173e-02,
       2.28013913e-03, 1.64757762e-02, 5.58937248e-03, 2.50858022e-03,
       1.57321629e-03, 1.01439678e-03, 7.50507927e-04, 4.35433164e-03,
       1.08180456e-02, 3.87310656e-03, 1.61336828e-02, 2.82448833e-03,
       8.51113908e-03, 7.18564901e-04, 1.43983564e-03, 7.47164199e-03,
       6.04854431e-04, 3.37479892e-03, 6.96625153e-04, 9.92073328e-04,
       3.16593284e-03, 1.49843935e-03, 1.59557071e-03, 7.20739039e-03,
       1.32453197e-03, 1.27423822e-03, 2.33524086e-04, 5.72226476e-03,
       4.45373030e-03, 3.34358797e-03, 8.99202074e-04, 7.90964928e-04,
       6.39860693e-04, 3.87283880e-03, 2.15104409e-02, 5.23794268e-04,
       6.54655648e-03, 1.69557123e-03, 1.86997093e-03, 6.54583378e-03,
       1.14647031e-04, 1.86299381e-03, 1.50379157e-02, 8.54872074e-03,
       1.55954552e-03, 8.65027774e-04, 2.07721815e-03, 5.74913167e-04,
       9.21238039e-04, 4.80385125e-03, 1.29376317e-03, 9.53579601e-03,
       7.65499775e-04, 3.82859696e-04, 4.42725111e-04, 9.25636571e-03,
       4.28898929e-05, 1.01199234e-03, 3.36269033e-03, 8.24634044e-04,
       2.43069394e-03, 6.64979406e-03, 2.74813501e-03, 6.77785743e-03,
       6.80347031e-04, 1.55767438e-03, 4.69290242e-02, 1.85365900e-02,
       1.71198975e-02, 9.30158328e-03, 1.09881337e-03, 5.36150008e-04,
       7.24254036e-03, 1.36433123e-03, 8.56807921e-04, 6.98851282e-03,
       8.80026433e-04, 1.15604084e-02, 1.84443034e-03, 1.70464686e-03,
       1.89847418e-03, 1.15581497e-03, 4.58308822e-03, 5.44565904e-04,
       3.42856371e-03, 1.34240452e-03, 3.18484847e-03, 1.28582085e-03,
       1.10274018e-03, 1.02239312e-03, 3.56353098e-03, 1.42452295e-03,
       5.05467178e-03, 9.48595908e-03, 2.08944641e-03, 6.75698742e-04,
       4.06511035e-03, 8.29360262e-03, 4.20183642e-03, 4.21250996e-04,
       4.23200242e-03, 3.78045184e-03, 4.94086742e-03, 2.23602494e-03,
       1.96589832e-03, 1.91163586e-03, 2.78747105e-03, 4.80552018e-03,
       3.38107347e-04, 1.13958912e-02, 5.63195581e-03, 3.73085262e-04,
       7.33060110e-03, 6.23986730e-03, 9.02594626e-03, 2.00836081e-03,
       1.51745568e-03, 2.25021015e-03, 2.47238524e-04, 1.26833061e-03,
       5.81709156e-03, 1.06720161e-03, 6.83117309e-04, 3.91700305e-03,
       3.97923961e-03, 3.07709374e-03, 2.90895556e-03, 1.24557018e-02,
       1.15110772e-03, 7.03792460e-03, 4.72390180e-04, 8.02712608e-03,
       3.98303010e-03, 3.12129897e-03, 3.22322012e-03, 2.12204596e-03,
       1.59125235e-02, 2.09152680e-02, 6.50414173e-03, 1.66653492e-03,
       3.59444553e-03, 1.45876799e-02, 3.54084955e-03, 3.27777606e-03,
       1.33667211e-03, 1.29132837e-04, 3.77026410e-03, 2.13026498e-02,
       1.81374815e-03, 7.97334069e-04, 9.33769508e-04, 1.47530297e-02,
       1.96301169e-03, 4.73475689e-03, 1.06624793e-02, 1.51286542e-03,
       9.16700251e-03, 5.09111676e-04, 9.01488308e-03, 4.73959558e-03,
       2.97358073e-03, 1.81500465e-02, 7.64568103e-04, 1.25619481e-04,
       3.56743019e-03, 1.54783844e-03, 6.53645908e-03, 1.01249688e-03,
       7.29749305e-03, 5.41025167e-03, 6.14395319e-03, 3.17976665e-04,
       1.30007346e-03, 5.64685499e-04, 5.16130729e-03, 4.41109063e-03,
       1.27839705e-03, 3.70266312e-03, 5.20677364e-04, 3.36005073e-03,
       2.01555638e-04, 7.61653204e-03, 7.06137391e-03, 2.06731213e-03,
       3.06276197e-04, 2.20938632e-03, 7.76863890e-03, 1.36575866e-02,
       5.26297092e-02, 5.68088749e-03, 3.76688462e-04, 7.84182397e-04,
       1.95730478e-02, 3.16747092e-03, 5.61464950e-03, 5.03474439e-04,
       1.02131646e-02, 3.77265713e-03, 7.38112815e-03, 1.13829985e-04,
       2.35289510e-04, 1.62947574e-04, 3.49796982e-03, 1.65834767e-03,
       2.20360304e-03, 2.45133392e-03, 1.33629618e-02, 1.46963552e-03,
       3.52783091e-02, 5.84609061e-03, 5.53749315e-03, 2.61608977e-03,
       1.51632365e-03, 4.02356219e-03, 4.69433330e-03, 1.82430365e-03,
       6.47638633e-04, 9.51198861e-03, 3.35489982e-03, 4.00127992e-02,
       2.84601789e-04, 6.98526716e-03, 1.64429527e-02, 4.86996444e-03,
       7.99420569e-03, 1.57597777e-03, 2.10858649e-03, 8.42468534e-03,
       2.63678754e-04, 4.75196820e-03, 1.90246722e-03, 2.25521028e-02,
       2.42645899e-03, 2.14069127e-03, 2.55349674e-03, 1.70306594e-03,
       1.24754207e-02, 9.16119665e-03, 2.21001566e-03, 4.36855626e-04,
       1.08098751e-03, 5.35251282e-04, 1.63953600e-03, 9.00333468e-03,
       1.44155808e-02, 2.57230201e-03, 1.51774602e-03, 3.31192501e-02,
       1.44124741e-03, 9.45387781e-03, 5.80102252e-03, 2.84990183e-05,
       1.04506046e-03, 1.31515535e-02, 5.85642690e-03, 4.60309302e-03,
       2.90493667e-03, 1.86922099e-03, 2.18260568e-03, 3.85691202e-03,
       9.19356360e-04, 6.78151322e-04, 1.02243363e-03, 1.09916891e-03,
       1.35744624e-02, 6.60116028e-04, 7.81757664e-03, 1.04980951e-03,
       6.01397827e-04, 2.93487497e-03, 9.79522616e-03, 2.35842238e-03,
       5.48811769e-03, 2.33108993e-03, 3.37429903e-03, 2.94552799e-02,
       1.70410089e-02, 5.37222950e-03, 6.56657433e-03, 5.62110916e-03,
       6.29932154e-03, 3.39249079e-03, 6.28548348e-03, 2.96825054e-03,
       1.32594118e-02, 5.01772063e-03, 3.39424307e-03, 6.22659409e-03,
       1.21659627e-02, 7.22686620e-03, 1.34856775e-04, 3.92544037e-03,
       2.17684312e-03, 1.15313493e-02, 2.32024482e-04, 5.93233563e-04,
       9.10894305e-04, 1.51119812e-03, 3.18878586e-03, 2.52929819e-03,
       1.73132326e-02, 5.16797928e-03, 8.82938679e-04, 1.96753871e-02,
       4.95494157e-03, 3.37956985e-03, 3.16566043e-03, 1.22216591e-06,
       1.04343006e-03, 2.46763974e-03, 8.29969707e-04, 5.14871965e-04,
       1.16203194e-02, 3.60802608e-03, 4.36809333e-03, 5.13192359e-03,
       2.17986573e-03, 5.80482977e-03, 1.64881628e-03, 1.53311044e-02,
       4.01615351e-03, 6.40289346e-03, 7.73398019e-03, 6.28379872e-03,
       8.09248537e-03, 3.70476604e-03, 5.52616606e-04, 2.49073235e-03,
       4.98015841e-04, 4.08683624e-03, 9.49689711e-04, 1.96152460e-03,
       1.61806457e-02, 2.29199361e-02, 7.49523810e-04, 4.48255008e-03,
       4.58822679e-03, 2.20448361e-03, 9.89166321e-04, 1.52422965e-03,
       3.61246336e-03, 2.80606240e-04, 2.87458138e-03, 6.53684698e-03,
       4.97924676e-03, 5.28656878e-04, 1.32333918e-03, 1.49877453e-02,
       6.11220894e-04, 2.25965735e-02, 2.62639928e-03, 6.54044095e-04,
       9.76921059e-04, 1.63137319e-03, 1.17395108e-03, 7.59269251e-03,
       4.74952254e-03, 5.43573825e-03, 1.48476718e-03, 3.84438827e-05,
       3.22869164e-03, 1.26379738e-02, 3.08664958e-03, 7.90975173e-05,
       2.11259257e-02, 5.36693376e-04, 5.40897832e-04, 1.72706787e-04,
       7.58783706e-03, 9.12544027e-04, 3.02163162e-03, 2.91359937e-03,
       2.63724267e-03, 1.33733451e-03, 1.66676403e-03, 4.53393813e-03,
       6.49837020e-04, 6.74937945e-03, 2.52786139e-03, 1.65689993e-03,
       1.89912878e-03, 6.73788833e-03, 2.35377555e-03, 1.01668888e-03,
       9.65166255e-04, 5.78108127e-04, 6.66434411e-03, 7.72970868e-03,
       1.09167758e-03, 1.72684388e-03, 3.70457140e-03, 2.09016297e-02,
       4.58842237e-03, 8.61157943e-03, 1.18343038e-02, 4.87697273e-02,
       4.86439123e-04, 1.85764569e-04, 5.10543026e-03, 3.48987989e-03,
       3.67332541e-05, 1.90321810e-03, 5.51076280e-03, 1.63797401e-02,
       2.09954291e-04, 3.69096268e-03, 6.16083900e-03, 6.75756205e-03,
       1.97883882e-03, 7.54224230e-03, 1.99614819e-02, 8.61260341e-04,
       2.65543768e-03, 7.32452085e-04, 1.62549154e-03, 2.39016605e-03,
       1.08598371e-03, 9.98321641e-03, 3.41869891e-03, 1.89666811e-03,
       7.02561159e-03, 7.48329505e-04, 2.42667214e-04, 3.31929652e-04,
       3.31702549e-03, 3.30043724e-03, 1.03428103e-02, 3.13962018e-03,
       2.74082739e-03, 4.39462811e-03, 3.50680458e-03, 2.91763549e-03,
       1.05885537e-02, 3.13464669e-03, 1.24710063e-02, 3.23541160e-03,
       1.21284823e-03, 1.51456310e-03, 1.91259023e-03, 2.18645763e-03,
       6.47870079e-03, 6.65627827e-04, 1.26577774e-03, 2.40293816e-02,
       4.04487713e-04, 1.17623259e-03, 1.21125719e-02, 4.59368632e-04,
       6.25602016e-03, 6.40686275e-03, 2.82109552e-03, 3.17448692e-04,
       2.12304038e-03, 1.01163387e-02, 1.19270571e-03, 5.43837203e-03,
       7.61960808e-04, 4.62467055e-04, 8.49986565e-04, 4.11714986e-03,
       4.68380377e-03, 2.68768962e-03, 5.61274681e-03, 1.76422130e-02,
       1.48843392e-03, 2.25132913e-03, 6.09044638e-03, 4.85589821e-03,
       1.46385003e-03, 1.88751752e-03, 9.18452221e-04, 5.84732369e-03,
       6.73741940e-03, 1.24353194e-03, 2.88010202e-03, 6.33803313e-04,
       1.36262202e-03, 9.42870451e-04, 1.28530606e-03, 2.46495451e-03,
       2.75402167e-03, 9.75031464e-04, 1.31815998e-02, 1.14211673e-03,
       1.96553441e-03, 9.25292447e-03, 4.19189828e-03, 8.82562157e-03,
       3.71238275e-04, 2.28719949e-03, 4.64312499e-03, 3.62599711e-03,
       2.33217631e-03, 5.24761504e-04, 6.87806983e-04, 4.51417454e-03,
       1.69693865e-03, 6.02205005e-03, 1.42329501e-03, 2.40462855e-03,
       1.06834266e-02, 6.62545208e-03, 4.58958745e-03, 4.48430562e-03,
       1.59257110e-02, 2.06669606e-03, 3.35569773e-03, 1.79860869e-03,
       7.77639030e-03, 1.85487769e-03, 4.25905408e-03, 7.57752266e-03,
       2.94783129e-03, 5.52420225e-03, 3.50660342e-03, 1.42514403e-03,
       3.52820777e-03, 2.29478886e-04, 1.63170137e-03, 6.88121887e-04,
       4.37886314e-03, 4.37799282e-02, 8.67633894e-03, 5.11412648e-03,
       1.12954387e-02, 1.09778829e-02, 7.71727704e-04, 1.40660908e-03,
       6.34871889e-04, 1.63289113e-03, 1.03303799e-02, 1.23412590e-02,
       3.26436362e-03, 4.75888344e-04, 6.63008075e-04, 4.77739237e-03,
       5.59713284e-04, 1.11065130e-03, 8.69276468e-04, 1.59082375e-02,
       7.17593124e-04, 4.21024743e-04, 4.95716855e-02, 8.29296361e-04,
       8.46691255e-05, 1.97258219e-03, 3.52047995e-04, 3.76965501e-04,
       1.08394353e-03, 1.07779168e-02, 9.51795001e-03, 2.80018453e-03,
       6.31684111e-03, 2.73082434e-04, 3.19233397e-03, 2.87668023e-04,
       9.34054516e-03, 1.87319890e-03, 1.87348446e-03, 6.60243037e-04,
       5.58885804e-04, 4.40839864e-03, 2.48756399e-03, 1.11023560e-02,
       5.62714413e-04, 1.15504558e-03, 7.36352801e-03, 1.74833380e-03,
       3.60845402e-03, 5.07860037e-04, 1.05845295e-02, 2.25088932e-03,
       2.91872513e-03, 2.51189875e-03, 4.87961760e-03, 7.57942908e-04,
       4.41885437e-04, 4.36700787e-03, 5.58615953e-04, 1.07237147e-02,
       2.00298009e-03, 4.13938658e-03, 3.52272252e-03, 2.71979696e-03,
       1.44671332e-02, 2.67763417e-02, 5.44422958e-03, 1.33455591e-02,
       1.37288254e-02, 1.03610952e-03, 1.96284498e-03, 9.36773233e-03,
       3.64361971e-04, 3.18893325e-03, 4.06235922e-03, 2.95057381e-03,
       3.99176963e-03, 6.67587668e-03, 1.35328714e-03, 1.07760075e-02,
       1.61159318e-03, 1.43057934e-03, 6.71708072e-03, 2.88470555e-03,
       2.59311553e-02, 3.64004099e-03, 3.14452196e-03, 4.71603125e-05,
       2.99972459e-03, 4.71748551e-03, 7.89412297e-03, 1.26820372e-03,
       1.55735516e-03, 6.20856555e-03, 3.86100193e-03, 2.98126834e-03,
       2.23197951e-03, 7.10496539e-03, 2.11115321e-03, 3.32130655e-03,
       1.21173053e-03, 3.30848061e-02, 7.36412918e-03, 4.83135469e-02,
       3.03837657e-03, 1.13720808e-03, 7.09752832e-03, 1.12835981e-03,
       3.30246240e-02, 2.60687340e-03, 6.67369086e-03, 3.84113169e-03,
       2.32423336e-04, 7.51239108e-03, 2.47413456e-03, 1.04612648e-03,
       3.39247962e-03, 1.75972015e-03, 1.30740441e-02, 7.65245594e-03,
       2.09151395e-02, 4.29748878e-04, 2.06066784e-03, 4.41557233e-04,
       1.89469499e-03, 3.07795731e-03, 1.30983489e-02, 4.05351212e-03,
       2.21705600e-03, 5.03062096e-04, 9.31803603e-04, 5.65092219e-03,
       3.75951931e-04, 1.75112183e-03, 1.86387114e-02, 7.41056807e-04,
       2.15199616e-04, 5.55301039e-03, 4.83075343e-03, 1.65460247e-03,
       1.60786277e-03, 1.53634348e-03, 1.58932991e-02, 3.50857998e-04,
       2.50386598e-04, 8.87663290e-03, 5.52078849e-03, 2.99938227e-04,
       5.33942925e-03, 1.86430197e-03, 3.62320989e-03, 2.57190084e-03,
       1.95083879e-02, 1.35644758e-03, 6.28486881e-03, 1.26744024e-02,
       1.58916425e-03, 2.42996495e-03, 4.68117604e-03, 1.19356229e-03,
       5.91855217e-03, 1.36105076e-03, 6.68000372e-04, 3.28194187e-03,
       1.02477765e-03, 1.42659293e-03, 4.89692250e-03, 3.36924160e-04,
       2.36912188e-03, 5.54646784e-03, 4.89371875e-03, 7.42584979e-03,
       3.01281945e-03, 6.36415277e-03, 1.08964434e-02, 4.47858917e-03,
       3.84649704e-03, 2.03841389e-03, 7.24703015e-04, 1.36939774e-03,
       2.06351024e-03, 9.41763725e-03, 1.80272956e-03, 8.12977552e-03,
       4.70749568e-03, 6.39637699e-03, 4.71770484e-03, 8.66199099e-03,
       2.00154795e-03, 2.80789332e-04, 4.95124329e-03, 4.79087280e-03])

embeddings_percentile_1 = np.array([-1.41540831e-02,  9.01912992e-02, -2.61103024e-02,  2.96557894e-02,
       -1.15111719e-02,  1.99785924e-02, -2.67453599e-03, -2.36159455e-02,
       -1.36751391e-02, -5.83293913e-02, -1.31009775e-02,  4.60745743e-02,
       -4.41588531e-02,  1.25128987e-03, -9.18370133e-04, -8.88828802e-02,
       -2.39556045e-02, -4.59823716e-01,  3.32323372e-02, -4.23861393e-02,
       -2.71381258e-03,  1.20719803e-02,  4.79668174e-02,  2.99080529e-02,
       -4.27012882e-02, -2.10096063e-02, -2.58950656e-04,  3.29517842e-03,
       -1.10668025e-02, -1.80646221e-03,  2.62479060e-02,  2.87115076e-02,
       -8.95316696e-03, -3.02911085e-02,  1.84804676e-04, -6.05795547e-03,
       -4.62677363e-02,  7.34762821e-03, -1.13817620e-04,  1.21498869e-04,
       -1.04462184e-01,  8.74687176e-03, -9.08040429e-03, -7.45133878e-03,
       -4.19464438e-02, -1.44514722e-03,  3.82769430e-02,  1.60705582e-03,
       -4.12178154e-02, -9.65411564e-03, -3.45113417e-03,  3.35253390e-03,
       -2.51273013e-03, -5.55280992e-03, -7.56209156e-02, -7.88001588e-02,
       -8.36406214e-03,  4.03379288e-02, -9.74926803e-02,  2.50954824e-02,
       -5.13795926e-03, -2.91637420e-03, -1.29541222e-02, -8.12483177e-03,
       -6.19783540e-02, -1.33503528e-02, -1.44631483e-02, -1.92693922e-02,
       -2.22313731e-02, -2.64739758e-03, -4.67320389e-03, -1.03741270e-02,
        2.72032965e-03, -6.54224177e-03, -1.24208743e-02, -5.38029367e-03,
       -2.14750173e-02, -7.58148344e-03, -8.52122488e-03, -3.51515828e-02,
       -6.22208944e-03, -1.36087341e-03, -1.76741558e-03, -5.07410762e-02,
        8.13076282e-03,  3.38969531e-03, -1.13038985e-03,  3.76679730e-04,
        1.69951212e-02, -2.93095331e-02, -7.51853195e-02,  7.73335097e-03,
        1.25817417e-02, -7.31983879e-03, -4.87229066e-03, -1.08470417e-02,
        2.89982748e-04,  9.35472694e-05, -7.96533057e-02,  2.35015389e-02,
       -7.17405658e-03,  5.48677529e-03, -1.75576377e-02,  3.47265350e-03,
        8.16418076e-03,  9.87604531e-03, -3.34091626e-03, -1.37259396e-01,
       -2.31233472e-03, -1.41937711e-03,  3.57659092e-03,  1.01503180e-02,
       -2.40912291e-03, -2.29432793e-02,  1.62043970e-02, -2.15143795e-03,
       -2.87547303e-02,  2.61212191e-02,  1.68784776e-02, -7.56893991e-02,
        9.77961302e-03, -1.39553220e-02, -9.08082578e-02, -9.14381686e-02,
        5.77857962e-02,  1.11177999e-02, -4.45416414e-03,  7.21534518e-03,
       -1.58360589e-01,  1.31446394e-03, -3.12264708e-03,  3.22892606e-02,
        4.58909146e-04,  3.53837544e-02, -7.08031381e-03, -9.71365090e-04,
        6.85047704e-02, -4.82399212e-03, -1.30508037e-03, -2.00783395e-03,
       -2.08120383e-02, -1.49516924e-04, -1.11633034e-02, -5.99369615e-03,
        1.01763066e-02, -4.88776949e-03, -6.11185458e-02, -1.16578109e-02,
        1.03205649e-02, -1.80704025e-02, -5.86305513e-03, -5.84472315e-03,
       -2.46094837e-02, -5.50201377e-02, -6.48038627e-03,  4.64887195e-04,
        1.08124330e-02,  1.03944201e-02, -1.27943293e-02, -2.00307913e-02,
       -2.79497926e-03,  1.08334357e-02,  1.93853786e-03, -2.63570606e-02,
        2.98497550e-03,  3.14313147e-02, -2.69220695e-02,  2.52508843e-03,
        6.86808138e-02,  1.05033933e-03,  3.72482774e-02, -4.74285422e-03,
       -2.77878216e-02, -1.91964646e-02, -5.22061448e-05, -9.11116306e-03,
       -9.60217880e-03, -8.60664304e-03,  4.95533519e-03, -6.47172531e-02,
       -3.12679599e-02, -5.36886938e-02, -2.17477963e-02, -1.56014139e-02,
        1.22250406e-02, -2.64135617e-03, -1.54886489e-04, -4.46264267e-04,
        1.89707034e-02, -2.65556802e-02,  1.01447612e-02, -1.48771948e-02,
       -2.06241836e-02, -1.21576457e-01,  6.37973519e-02,  9.68829367e-03,
       -3.53828503e-02, -1.18030244e-02, -1.17862714e-02,  3.90415633e-02,
       -4.21550413e-03,  2.72181639e-03,  5.64900564e-02, -5.40790477e-02,
        4.72704688e-03, -1.33095359e-03,  3.80480941e-04, -6.60456152e-02,
       -1.77766108e-02, -2.07003491e-02, -1.95098411e-03,  6.26478782e-03,
       -7.05430406e-02,  1.17244329e-03, -7.26293521e-02, -3.48754723e-02,
       -6.00690412e-02, -1.12276998e-01, -2.76058806e-03, -5.05722114e-04,
       -3.73624349e-03, -4.13073878e-03, -2.16958848e-02, -4.14395283e-03,
        1.90144650e-01,  8.91387737e-02, -1.69162861e-01,  5.43485020e-04,
        1.97615954e-02,  2.15920719e-04, -6.71527451e-02,  7.58312787e-02,
        1.42286853e-03, -3.31208909e-02, -5.50130933e-03,  4.03336220e-03,
        7.57317051e-03, -1.47821908e-02,  1.07243542e-01, -1.07968229e-02,
       -4.81389775e-03, -8.13191397e-02, -7.75510244e-01, -4.65791596e-02,
        3.63108281e-01, -2.29654943e-02, -1.41370988e-03, -7.91219417e-03,
       -6.60125102e-02, -7.21645050e-02, -3.92042867e-03, -3.03949758e-03,
       -1.15431525e-02, -5.68339905e-03, -5.69598552e-02,  1.08301884e-03,
       -8.40904594e-04,  2.86043319e-03, -3.42103550e-03, -3.09096761e-03,
        9.68582688e-03,  2.17221387e-03, -1.41317611e-01, -2.17645659e-03,
       -2.67960189e-01,  4.97766024e-03, -3.19511361e-02, -5.84351417e-03,
       -7.53047395e-04,  1.53620386e-02, -4.72926950e-02,  3.81766122e-03,
        1.56115428e-03,  1.68076479e-01,  2.19352893e-03, -1.95627717e-01,
       -5.35877647e-04,  3.95341148e-04, -2.12231950e-02, -1.51901219e-02,
       -3.57747650e-02,  1.18269438e-03, -3.67526263e-02, -3.46731959e-02,
       -9.11039220e-04,  2.61022532e-02, -5.50419906e-03,  9.17638689e-04,
       -8.39735074e-04, -4.97169398e-03,  7.48989454e-03, -5.67855269e-03,
       -2.27378837e-02, -3.37770676e-03,  4.18987300e-03, -8.38627362e-04,
        7.82916613e-03, -4.87482421e-03, -2.55059183e-02, -2.03501284e-01,
        5.01749749e-03,  1.84153860e-02, -4.13478955e-04, -2.11955883e-01,
       -7.74895618e-03, -4.16458326e-02,  5.62914488e-02, -1.96791106e-03,
       -7.24193336e-03, -7.94372109e-02,  9.48201686e-03,  5.70376608e-03,
       -1.43857196e-02,  4.28115793e-03, -8.61734467e-04, -3.84902867e-03,
       -9.67712516e-03, -3.31822872e-03,  1.51959099e-03, -6.55723798e-03,
       -5.34889338e-02, -1.77992102e-02, -8.29463880e-02, -3.03529102e-03,
       -5.89940251e-03,  7.69806033e-03, -1.57702551e-02, -5.55532647e-02,
       -2.58258412e-02, -1.57818462e-02, -2.37028128e-02, -5.39263806e-02,
        3.48553851e-02, -7.45014112e-03,  1.05274216e-02, -4.46790565e-02,
       -4.50860882e-02, -8.14743055e-03, -5.80899546e-02, -5.93030638e-03,
       -1.19781810e-02,  1.95005117e-02,  3.67325176e-03, -2.40922789e-02,
        8.93312027e-04,  3.52738655e-02, -6.00378658e-04,  1.79141344e-02,
        2.08545169e-03, -6.67320493e-02, -3.60430254e-04,  7.33978183e-03,
        5.27826342e-07,  2.78634358e-02,  1.45538135e-02,  5.40399662e-02,
       -4.62408593e-02, -5.74364220e-03, -6.10931266e-03, -1.21966833e-01,
       -1.42856077e-02,  1.00895415e-02,  4.92588356e-03,  7.35294319e-04,
       -1.65693707e-02, -6.04492513e-02,  3.57359485e-03, -2.55434154e-03,
       -3.06741137e-02, -5.63739490e-03, -7.07773398e-03,  1.37230423e-03,
       -4.92085977e-02, -1.91273887e-02,  2.59595299e-03, -2.69456058e-02,
        2.03468848e-02, -9.74733541e-03, -2.16176701e-02, -5.19685836e-02,
        5.48108041e-03, -1.08172383e-02,  8.90464850e-03, -4.42656593e-03,
        3.53718589e-04, -3.19788869e-02,  2.66555894e-03,  4.95747985e-03,
       -8.17483999e-02, -8.42754267e-02,  2.26306707e-02,  9.59508816e-03,
        2.04632467e-02,  9.78167428e-03,  6.36647426e-03,  7.67698287e-04,
       -9.73932641e-03, -4.94616141e-05,  1.52066557e-02, -4.58078337e-02,
       -3.00449331e-02,  6.23724715e-03, -1.74947385e-02,  1.11990608e-01,
        4.06582343e-03, -3.78646795e-01,  6.10078944e-03, -7.71622812e-03,
        8.26390285e-03,  4.00454019e-03,  2.78282109e-03, -1.65908966e-02,
       -3.95439758e-03,  8.36869171e-03,  1.79098519e-02, -1.94583732e-03,
       -6.88457861e-03, -3.99948412e-02,  8.27185255e-03, -2.63836636e-04,
       -6.06989726e-02, -9.37895339e-04, -2.77014303e-03,  2.14205917e-03,
       -6.29861873e-02,  1.09221102e-02, -1.08555146e-03,  2.61259509e-02,
       -2.00536318e-02,  3.45102636e-03, -7.69575567e-05, -5.83968238e-02,
        6.63249546e-04, -1.62640475e-01, -2.92422827e-02, -2.47912408e-02,
       -2.69107920e-02, -4.94261491e-02, -2.45291636e-02, -9.04403728e-03,
       -9.94200379e-03, -8.30734109e-04,  2.88728952e-02, -7.15593296e-02,
       -9.68403192e-03, -2.06120972e-03,  1.29186484e-02, -4.74364741e-03,
        1.06935828e-02, -1.11295701e-01, -6.00347771e-02, -8.51038823e-02,
       -6.73743376e-04,  3.16095050e-03, -2.98909459e-02, -9.76130797e-03,
       -7.27245427e-04, -9.95889040e-03,  1.86492543e-02,  5.83442668e-02,
       -6.55978670e-03, -8.89642965e-03, -4.09213759e-02,  3.70089535e-03,
       -2.59614889e-03, -3.44136167e-02, -1.30780041e-01, -8.81441168e-03,
       -1.04643940e-02, -8.52768332e-04,  6.47681619e-03, -5.02529841e-03,
       -7.04695106e-03,  1.30598173e-01, -4.58349918e-03, -5.35487001e-03,
        3.14703091e-03, -1.02049839e-02,  2.92324482e-03, -4.49564064e-03,
        3.44423775e-03, -7.62481489e-03, -1.17641134e-01,  9.62505238e-03,
       -7.66500998e-02, -3.38872416e-02, -1.78664030e-02, -3.90248003e-03,
       -8.30321965e-02, -1.91176886e-02, -4.01247437e-02, -2.01691226e-03,
       -1.33291489e-02, -1.86952504e-02, -2.12887521e-02,  3.91186701e-03,
       -5.71582463e-03, -1.27815753e-03,  8.68345208e-03, -2.22399594e-01,
        6.92011080e-03,  1.94997447e-02, -6.28994091e-02, -1.78854704e-03,
       -2.47461370e-02, -6.75322442e-02, -3.10653503e-02,  4.47839255e-03,
       -8.04568082e-03, -1.46457009e-02,  2.04079619e-02,  5.50421655e-03,
       -1.25975508e-03,  7.94804890e-03, -2.37813273e-03, -4.19757135e-02,
        1.45547025e-02, -1.69565660e-02, -1.54322480e-02, -2.34419201e-01,
       -8.88893519e-03,  2.07230529e-04,  1.83629206e-02, -1.87265800e-02,
       -1.83256946e-02,  2.55522603e-03,  5.50067844e-03, -2.75840625e-02,
        1.73580792e-02,  1.69336110e-05, -2.06127599e-02, -7.64871773e-03,
       -2.29893341e-02,  7.26737687e-03,  1.28575204e-02, -1.32290823e-03,
       -3.31193851e-02, -7.40684260e-03, -1.70990601e-01,  1.46915052e-02,
       -3.44682616e-02,  3.45661035e-02, -1.69154578e-03, -7.62378427e-02,
        1.20921978e-02,  5.38179725e-03,  8.67676085e-04,  1.75893637e-02,
       -9.39572845e-03, -1.57915491e-03,  4.47259614e-03, -2.21525215e-03,
       -1.32956292e-02, -2.16498676e-02, -9.37000757e-03,  2.42202258e-03,
       -1.15673950e+00, -3.63124083e-02, -2.56264022e-02, -3.51313908e-02,
       -5.37372018e-02, -1.61715101e-02, -2.74802898e-02, -2.66873385e-02,
       -2.65483493e-02, -7.92524971e-03,  4.85587263e-03,  4.76062689e-02,
       -7.02019585e-03, -1.08972675e-01, -2.55203525e-02,  5.74431311e-03,
       -8.23918872e-03, -6.01671734e-03, -6.52355202e-03,  1.71974257e-02,
       -3.39441349e-03, -1.16993582e-02, -6.58085293e-02, -5.13691889e-02,
        2.50031093e-01,  4.59843342e-02,  1.30525863e-02, -1.15249507e-02,
       -5.13741204e-03,  5.82228620e-04, -2.05852148e-01, -6.05151668e-02,
        1.21151437e-02,  1.69222096e-03, -9.34763517e-03,  1.85726005e-02,
       -2.41790011e-03,  5.73262783e-03, -7.77416140e-03, -1.30812622e-01,
        8.50876585e-03, -1.79290590e-03, -6.11247253e-01, -8.06479011e-03,
        5.27406243e-04, -3.07177102e-02,  3.77798013e-03,  2.42302299e-03,
       -1.74465805e-02,  3.75538301e-02,  2.49772158e-02,  1.34776345e-02,
       -7.74347778e-02, -4.20731121e-03,  2.03945562e-02, -1.40867114e-03,
       -5.19318030e-02, -1.04301286e-02,  1.70059101e-02, -9.04473776e-04,
       -6.79162017e-05, -6.32499964e-04,  7.63273864e-03,  6.72662686e-01,
       -2.31267170e-03,  1.59817395e-03,  3.40565591e-02, -1.27345447e-03,
       -1.85752795e-02,  2.01652932e-03, -2.29410988e-02,  2.75044546e-03,
       -2.24059412e-02,  3.32254332e-03, -4.47574003e-02,  1.30220897e-02,
       -2.89520623e-03, -3.33953828e-02,  4.52937577e-03,  2.22365446e-02,
       -9.53409931e-03,  9.20900721e-03,  1.40121643e-02,  5.28227957e-03,
       -3.18370657e-02, -3.72580156e-01, -3.09064906e-02,  4.16452914e-02,
       -9.24722837e-03,  9.61394522e-03, -5.72155874e-04, -4.26727936e-02,
       -6.02225435e-04,  2.56620058e-04, -3.08203105e-02,  1.04683165e-02,
       -2.54811273e-02, -5.15717248e-02, -1.06850609e-02, -3.36688588e-02,
        7.90155634e-03,  1.30634709e-02,  2.05040966e-02, -1.65288408e-02,
        6.33495222e-01,  2.94868057e-03, -9.73644525e-03, -5.62860622e-04,
       -2.56817321e-02,  1.22208443e-02, -1.04438027e-02, -6.54763248e-03,
       -4.89806388e-03, -3.21501100e-02, -1.58784106e-02,  5.36893342e-02,
        8.18828497e-03, -3.69504747e-02, -1.39141787e-02, -2.03204602e-02,
       -1.80839533e-02,  2.07463243e-01, -9.31489989e-02,  4.09055374e-02,
       -2.33981977e-02,  6.88132787e-03, -4.36576484e-02, -7.12335415e-04,
       -3.35486205e-01, -1.38423141e-02, -1.86488202e-02,  3.91362027e-02,
        1.56726668e-03, -9.97105407e-03, -4.51378448e-03,  9.40856225e-04,
       -1.29778569e-02,  1.15873389e-02,  4.33302369e-03, -3.62453503e-02,
       -5.20065751e-03,  8.07300696e-03, -4.68787940e-03, -2.53595204e-03,
       -1.24165906e-02, -1.77119176e-03, -3.39245428e-02,  1.01427160e-02,
       -2.20317781e-02, -6.71981886e-03, -4.73940171e-04, -2.20707425e-02,
        6.70240377e-03, -1.05857155e-02,  7.00594255e-02,  2.49629123e-03,
        1.75075087e-03, -1.05712352e-02,  1.98759649e-02, -3.13354168e-02,
        6.54744929e-03, -9.21170380e-03, -7.89151922e-02, -2.27818671e-03,
       -5.46601390e-03, -3.93354124e-02,  1.65466657e-02, -4.40043312e-03,
       -1.08769177e-01,  1.23878359e-02, -3.00776576e-02, -8.16204881e-03,
        2.18546230e-01, -1.38682146e-02, -1.89831693e-02, -2.52441239e-02,
       -5.67224659e-03,  3.92819013e-02,  9.43745997e-03,  2.42688079e-03,
       -1.98191672e-02,  7.90173722e-04, -1.37673005e-02,  3.02713943e-02,
        6.66598656e-03, -1.27087284e-02, -7.10409007e-03,  1.25484808e-05,
       -3.87948210e-03,  1.72733822e-02,  1.31992014e-02,  3.49600933e-02,
       -8.73060906e-03,  1.18259472e-02, -1.01151338e-01,  5.09070789e-04,
        1.17455092e-02, -6.17156724e-03, -1.990240350006e-03,  2.88242945e-03,
       -2.71033442e-02, -7.61359498e-02, -1.68719492e-02, -1.84102414e-02,
        1.01171173e-02, -4.50614142e-02, -4.73453067e-04,  1.70419478e-02,
       -7.09211047e-03, -6.23022892e-03, -2.57672653e-01, -2.74532928e-02])


embeddings_percentile_99 = np.array([ 1.18278238e-04,  1.21894051e-01, -2.05902043e-02,  4.48601153e-02,
       -5.57891147e-04,  4.48532478e-02,  1.14208688e-02, -4.72561701e-03,
        3.89634044e-02, -1.97478984e-02,  8.60330151e-03,  7.10888243e-02,
       -2.27807068e-02,  6.05957539e-03,  1.28627151e-02, -5.40370539e-02,
       -3.48291380e-03, -3.48819279e-01,  5.30508456e-02, -2.02273548e-02,
        1.32593798e-02,  2.77849001e-02,  5.78700437e-02,  3.97647793e-02,
       -2.86567594e-02, -6.24436048e-03,  1.04370293e-03,  1.27885246e-02,
       -3.23641778e-03,  7.76714751e-03,  5.01752683e-02,  7.98489241e-02,
       -4.49532683e-03, -9.06055873e-03,  4.14006334e-03, -2.73805568e-03,
       -2.76602514e-02,  1.16310865e-02,  1.84851115e-02,  1.03585702e-03,
       -3.35432141e-02,  1.32880163e-02, -2.78755971e-03,  6.92501652e-03,
       -2.96790220e-03,  1.76681044e-02,  5.26012446e-02,  4.54995850e-02,
        1.98844638e-02, -7.23604807e-04,  1.16296919e-02,  5.17601779e-03,
        9.27610907e-04, -4.41689909e-03, -1.89685204e-02, -2.65729327e-02,
        1.58083499e-03,  1.10222784e-01, -6.37879638e-02,  3.67170706e-02,
        2.64178197e-03,  1.30960818e-03, -9.49435048e-03,  1.07059796e-02,
       -1.61629037e-02,  8.76297733e-04,  5.07977338e-02, -8.44752995e-03,
        2.76499164e-02,  9.74460421e-04,  1.17778135e-03,  3.23864751e-02,
        5.22053001e-03,  6.67161623e-03, -9.59253309e-03, -9.63999197e-04,
       -3.83754035e-03, -2.25170558e-03, -6.79893165e-04, -6.57208835e-03,
        6.55611360e-04,  3.90856922e-03, -8.06583420e-04, -2.68963398e-02,
        2.70679661e-02,  1.68131010e-02,  2.57574571e-03,  3.33171108e-03,
        1.93694436e-02, -1.26693923e-02,  1.71245029e-02,  1.01735492e-02,
        4.80256031e-02,  2.27847050e-03,  4.74348409e-03,  1.45459659e-02,
        7.28872875e-04,  1.02992959e-02, -2.07847220e-02,  6.03312925e-02,
       -4.62174757e-05,  9.87267455e-03, -6.82932636e-03,  6.48284034e-03,
        1.25970858e-02,  3.47359852e-02,  2.52010107e-03, -9.39236102e-02,
        1.11861127e-03, -3.90462740e-05,  5.98351659e-03,  4.42080811e-02,
       -2.20311942e-03, -1.78666806e-02,  3.39309318e-02,  9.71553765e-04,
       -1.65909294e-02,  5.47458773e-02,  2.80599725e-02, -4.47648644e-02,
        1.31273560e-02, -8.29612575e-03,  1.09081555e-01, -1.67156183e-02,
        1.24572055e-01,  4.61996695e-02,  6.08856879e-04,  1.01265249e-02,
       -1.18760933e-01,  7.39130433e-03, -1.99272328e-04,  5.86303730e-02,
        5.53005761e-03,  8.35151355e-02,  2.40306636e-03,  7.09264969e-03,
        7.87325859e-02,  1.51871990e-03,  2.11049429e-02,  3.93557495e-04,
       -7.89697405e-03,  5.39442112e-03,  6.31931761e-03, -5.07771842e-04,
        1.53515096e-02, -1.02484189e-03, -4.65832482e-02, -4.62407109e-03,
        3.27358432e-02,  1.88982526e-02,  2.83972693e-03, -2.49239901e-03,
       -6.16689066e-03, -2.42857640e-02,  1.09442139e-02,  2.98606868e-03,
        3.07830092e-02,  2.85763479e-02,  7.23882580e-03, -1.07920537e-02,
        7.22116109e-03,  1.99222273e-02,  1.88067506e-02, -3.66931887e-03,
        4.34853812e-03,  7.74173738e-02, -3.39743472e-03,  4.47840067e-03,
        1.06325756e-01,  3.02630258e-02,  7.99567497e-02,  4.95369281e-03,
       -2.05893748e-02, -1.06984860e-02,  1.30180137e-03, -3.09217327e-03,
        1.43504999e-02, -3.33827096e-03,  7.78058121e-03, -4.27490681e-02,
       -9.74953879e-03, -3.96499608e-02, -9.42648506e-03,  4.04023845e-02,
        1.74547953e-02,  2.83371015e-02,  2.32396284e-03,  3.27832349e-02,
        3.58191919e-02, -1.15798223e-02,  2.45607349e-02, -3.34419512e-03,
        3.93879334e-02, -4.03272459e-02,  9.92830828e-02,  1.60090420e-02,
       -1.73162875e-02,  4.59343457e-02,  1.34077428e-03,  5.52761406e-02,
        2.33925083e-03,  3.38070107e-03,  7.16711953e-02,  4.48953988e-02,
        1.44252148e-02,  1.90634109e-03,  4.06818093e-03, -9.77688642e-03,
       -8.26972589e-03, -4.67026010e-05,  4.07167413e-02,  1.30756050e-02,
       -2.71889931e-02,  3.71957819e-03, -2.92903651e-02, -1.23182503e-02,
       -4.47038061e-02, -3.99042092e-02, -5.32337320e-05,  7.49756349e-05,
        1.21561967e-02,  1.90509729e-03,  1.98874136e-03,  9.30298264e-04,
        2.25458373e-01,  1.11097969e-01, -1.45290848e-01,  2.34367704e-03,
        2.60821990e-02,  2.92334585e-03, -4.03801051e-02,  9.82716201e-02,
        7.74054086e-03, -1.72963542e-02, -2.83776381e-03,  1.82583297e-02,
        8.56007466e-03,  1.59352745e-02,  1.40359462e-01, -2.08985321e-03,
       -3.08793501e-03, -7.17365292e-02, -7.38748990e-01,  2.85912297e-03,
        5.86625047e-01,  1.91176392e-03,  1.06971339e-03, -3.40342626e-03,
        1.50643437e-02, -5.63543099e-02,  1.77233331e-02, -6.12940958e-04,
        2.43527044e-02,  9.54426326e-03, -2.43488912e-02,  1.54231365e-03,
        3.47539770e-04,  3.62126071e-03,  1.37746307e-02,  3.99584165e-03,
        1.96474881e-02,  1.16887924e-02, -7.03373230e-02,  4.04533565e-03,
       -1.03412542e-01,  2.83670003e-02, -1.12358938e-02,  8.38565752e-03,
        5.54591858e-03,  3.15043844e-02, -2.85230516e-02,  1.31729907e-02,
        4.61636631e-03,  2.14982264e-01,  1.58787796e-02, -3.99766741e-02,
        8.39579140e-04,  3.29675025e-02,  4.31214393e-02,  7.68701242e-03,
       -4.04793671e-03,  9.76091225e-03, -2.43101983e-02,  1.96658167e-03,
        4.06936434e-04,  4.57658647e-02,  2.90956478e-03,  1.14994688e-01,
        1.18497091e-02,  4.41587755e-03,  1.94864153e-02,  1.19518260e-03,
        2.88315745e-02,  3.44410504e-02,  1.37136021e-02,  8.85853630e-04,
        1.22624594e-02, -1.96957380e-03, -1.85522966e-02, -1.67639235e-01,
        6.15435334e-02,  3.35607582e-02,  5.71671462e-03, -7.24051777e-02,
       -1.10399692e-03, -8.05077219e-03,  8.47073540e-02, -1.81771452e-03,
       -2.18643985e-03, -2.01281662e-02,  3.82068351e-02,  2.75140584e-02,
       -2.82503334e-03,  1.44951425e-02,  7.70207294e-03,  1.22150188e-02,
       -5.63231242e-03,  4.29224933e-05,  6.02666580e-03, -8.06259733e-04,
        3.98220109e-03, -1.40868600e-02, -5.31264946e-02,  2.49927556e-03,
       -2.91812129e-03,  1.95983404e-02,  2.78288278e-02, -4.64268060e-02,
       -5.74322133e-03, -5.99355439e-03, -9.74925164e-03,  6.69656882e-02,
        1.19717823e-01,  2.04716827e-02,  4.43224878e-02, -1.98191357e-02,
       -1.43269496e-02,  7.65335270e-03, -3.25831588e-02,  7.44979967e-03,
        4.46089330e-02,  4.00633936e-02,  1.89007907e-02,  2.59740069e-03,
        5.36975639e-02,  6.58315478e-02,  1.34737038e-04,  3.51531361e-02,
        1.20393022e-02, -1.84178142e-02,  6.23446137e-04,  1.01193997e-02,
        4.30146246e-03,  3.39685751e-02,  2.75611046e-02,  6.78711395e-02,
        2.50270377e-02,  1.29040695e-02, -1.30597711e-03, -2.53116792e-02,
        4.98175601e-03,  2.64828073e-02,  2.02444026e-02,  7.41457150e-04,
       -1.15468171e-02, -4.89495282e-02,  6.80682186e-03, -4.65609420e-04,
        1.58699790e-02,  1.01962551e-02,  1.28249756e-02,  2.61934593e-02,
       -3.81787466e-02,  7.74388954e-03,  8.49094626e-03,  4.30170397e-02,
        3.74334618e-02,  1.52942979e-02,  1.14998319e-02, -2.38001674e-02,
        4.48647748e-02,  5.44839947e-03,  1.20533619e-02,  4.87726549e-03,
        2.83928052e-03, -1.40744001e-02,  7.22187676e-03,  1.29697571e-02,
        5.32316240e-03,  2.39178720e-02,  2.61141022e-02,  2.83358738e-02,
        4.03812958e-02,  1.94603597e-02,  1.00861632e-02,  9.32665445e-03,
        7.49431850e-03,  1.47762998e-03,  2.77771491e-02, -2.11253510e-02,
       -7.02765424e-03,  9.06473313e-03, -1.10267774e-02,  1.71456631e-01,
        6.78874170e-03, -2.46933572e-01,  1.60142243e-02, -4.27241114e-03,
        1.20925122e-02,  1.01535509e-02,  7.59548814e-03,  1.67655837e-02,
        1.39358841e-02,  3.10926740e-02,  2.50533428e-02, -1.76043210e-03,
        5.21638084e-03,  1.27737251e-02,  2.49642062e-02,  1.73355701e-04,
        2.43862607e-02,  9.94810676e-04,  1.17655962e-04,  3.06821708e-03,
       -2.87355553e-02,  1.58745591e-02,  1.18908300e-02,  3.98265518e-02,
       -9.08559313e-03,  8.34138634e-03,  6.83391247e-03, -3.61601160e-02,
        3.68915493e-03, -1.33830442e-01, -1.83786562e-02, -1.68462699e-02,
       -1.78652928e-02, -1.66358601e-02, -1.25234624e-02, -4.49901748e-03,
       -4.05051131e-03,  2.41521436e-03,  5.27708045e-02, -3.35950609e-02,
       -5.44144741e-03,  4.48405704e-03,  2.59964880e-02,  8.57664375e-02,
        3.31158131e-02, -7.77224976e-02, -3.51304139e-03,  1.15541628e-01,
        1.45879038e-03,  3.97550546e-03, -6.18509782e-03,  5.39563448e-03,
       -5.40429844e-04, -9.17770204e-04,  4.05258563e-02,  1.41948498e-01,
       -5.70859528e-03,  7.07183430e-03, -9.16624643e-03,  3.99909696e-02,
        5.08307692e-03, -3.04403051e-03, -3.56711593e-02, -4.70786370e-03,
        2.00536174e-04,  2.72497374e-03,  1.28390506e-02,  5.25718820e-03,
       -3.03573949e-03,  1.81525601e-01,  1.00954180e-02,  3.25137793e-03,
        3.21599755e-02, -6.77624824e-03,  4.36121549e-03, -3.01568675e-03,
        1.78759979e-02,  6.23921406e-03, -7.06464162e-02,  2.38236798e-02,
       -6.32790348e-02, -1.63566490e-02, -1.25542890e-03,  8.87256183e-03,
       -2.83062747e-02, -6.34146802e-03,  1.65794269e-02,  1.21020111e-02,
       -7.34832833e-03, -1.14702493e-02, -1.20442895e-02,  1.45456175e-02,
        2.55616402e-02,  2.21843814e-03,  1.46427932e-02, -8.88495396e-02,
        9.39712308e-03,  2.56975584e-02, -1.41082966e-02,  3.99139336e-04,
       -1.96836984e-03, -4.54153299e-02, -1.84990366e-02,  6.01968111e-03,
        6.59323852e-04,  2.86951711e-02,  2.64197385e-02,  2.58234796e-02,
        2.82621173e-03,  1.02946617e-02,  8.41000879e-04, -2.11225612e-02,
        3.46741589e-02, -5.39518191e-03,  9.92419511e-03, -1.41604526e-01,
       -1.24253337e-03,  1.03671835e-02,  4.46834043e-02,  7.88881082e-03,
       -1.12519161e-02,  9.73368561e-03,  1.00384526e-02,  9.38055848e-04,
        4.62050032e-02,  5.75484500e-03, -7.55021467e-03, -4.60619321e-03,
       -1.69788032e-02,  1.18852052e-02,  2.12476929e-02,  1.02860688e-02,
       -1.75638007e-02, -3.18523046e-03, -1.17891114e-01,  1.97737895e-02,
       -2.42906601e-02,  6.84536719e-02,  1.65512929e-02, -3.59936155e-02,
        1.40061097e-02,  1.59874545e-02,  1.92487462e-02,  3.64133929e-02,
        2.06193636e-03,  8.54239366e-04,  7.41499924e-03,  1.66941136e-02,
       -6.77557717e-03,  4.69627838e-03, -3.47720984e-03,  1.32752968e-02,
       -1.10269632e+00, -8.06474555e-03, -5.67342104e-03, -1.45870617e-02,
        1.43811345e-02, -8.21440049e-03, -1.45654928e-02, -1.78444480e-02,
        4.85122215e-03,  2.13898044e-04,  2.76630860e-02,  8.24514940e-02,
        8.14303532e-03, -8.12568851e-02, -1.03183577e-02,  1.19141979e-02,
        6.17447725e-03, -4.76878161e-03,  2.23169093e-03,  2.07322188e-02,
        1.76035845e-02,  1.83037675e-01, -2.90555281e-02, -2.94096080e-02,
        3.15171863e-01,  9.76884910e-02,  1.66911077e-02, -4.51161088e-03,
       -1.80815782e-03,  8.01876726e-03, -1.56636301e-01, -8.85986861e-03,
        2.49838746e-02,  3.82151632e-03, -5.92860505e-03,  4.05303073e-02,
       -3.08117754e-04,  1.02024885e-02, -3.56149162e-03, -5.22765046e-02,
        1.26215972e-02,  2.49212041e-04, -4.07580759e-01, -4.53827167e-03,
        9.77175701e-04, -2.15991775e-02,  5.35427928e-03,  4.23892630e-03,
       -1.22626746e-02,  8.09328039e-02,  6.39404115e-02,  2.66634839e-02,
       -4.46015190e-02, -2.81940353e-03,  3.70130326e-02, -1.23102491e-04,
       -1.48924385e-02, -2.35053977e-03,  2.47344841e-02,  2.30784582e-03,
        2.26362557e-03,  2.10314129e-02,  1.91966192e-02,  7.22578802e-01,
        7.76248553e-04,  7.67863978e-03,  6.11796311e-02,  6.44966998e-03,
       -2.42900883e-03,  3.84655513e-03,  1.63163254e-02,  1.47572706e-02,
       -1.13003129e-02,  1.39553052e-02, -1.85231749e-02,  1.67142165e-02,
       -1.02201182e-03, -1.35584577e-02,  6.93047833e-03,  6.69787836e-02,
       -1.23155775e-03,  2.48196303e-02,  2.73637901e-02,  1.67326701e-02,
        2.43643001e-02, -2.50981675e-01, -6.81596195e-03,  9.96532777e-02,
        4.60373157e-02,  1.56198211e-02,  1.00893752e-02,  4.33725878e-03,
        1.64335310e-03,  1.72767448e-02, -1.23330077e-02,  2.31744754e-02,
       -9.28668628e-03, -2.37986485e-02, -3.07556984e-03,  6.34356188e-03,
        1.56530678e-02,  1.88930925e-02,  4.87596342e-02, -3.26046837e-03,
        7.50364158e-01,  1.77245343e-02,  2.35458528e-03, -3.58313745e-04,
       -1.06555958e-02,  3.07748107e-02,  1.86660055e-02, -1.32594986e-03,
        2.27782208e-03, -5.21962010e-03,  1.13621869e-03,  6.80197068e-02,
        1.72739207e-02, -3.58105930e-04, -3.46510748e-03, -3.80554648e-03,
       -1.05564485e-02,  3.36932334e-01, -5.88195302e-02,  2.47603243e-01,
       -1.09616043e-02,  1.16120050e-02, -7.74879579e-03,  3.67086786e-03,
       -1.69944829e-01, -5.69626853e-04,  8.72484755e-03,  6.11492972e-02,
        2.91609167e-03,  2.85696016e-02,  5.55682333e-03,  6.11160448e-03,
       -6.45321923e-04,  2.13721777e-02,  5.21598156e-02, -6.87154989e-03,
        8.19375437e-02,  1.02766245e-02,  3.88895081e-03, -4.30212570e-04,
       -1.70765980e-03,  1.30234603e-02,  2.03323144e-02,  3.21877845e-02,
       -1.21428142e-02, -4.63715026e-03,  3.73814027e-03,  5.96658133e-03,
        8.59029233e-03, -1.50368113e-03,  1.62235224e-01,  5.47084998e-03,
        2.93986703e-03,  1.31073876e-02,  3.85144442e-02, -2.31611029e-02,
        1.40177429e-02, -2.48407722e-03, -2.09482878e-02, -4.34562886e-04,
       -4.45898294e-03, -3.52150717e-03,  4.05524212e-02, -2.96740797e-03,
       -7.98610155e-02,  2.13955525e-02, -1.49540470e-02,  1.68808354e-03,
        3.13117512e-01, -7.83414777e-03,  8.43057135e-03,  2.82954088e-02,
        3.46627547e-03,  4.96491776e-02,  2.96132956e-02,  7.87396628e-03,
        5.90695013e-03,  6.98228155e-03, -1.05104585e-02,  4.73264096e-02,
        1.24339069e-02, -5.17519532e-03,  1.02948660e-02,  1.78282897e-03,
        6.94191273e-03,  4.28506304e-02,  3.21383363e-02,  6.61375161e-02,
        3.19289261e-03,  4.47023155e-02, -3.94081747e-02,  1.93684366e-02,
        2.86862114e-02,  2.21034391e-03,  1.48990327e-03,  8.59704252e-03,
       -1.79792111e-02, -4.00501636e-02, -7.94832183e-03,  50001.27327361e-02,
        3.07123159e-02, -1.92445114e-02,  2.32247657e-02,  5.31380977e-02,
        4.26636458e-03, -5.11654912e-03, -2.34712559e-01, -7.02840643e-03])


inputs_mean = np.array([8.48627567e-01, 8.48627567e-01, 4.91625023e+01, 3.65907621e+00,
       3.83202095e+01, 7.23343551e-01, 5.74452257e+00, 4.08790112e-01,
       3.06559414e-01, 2.26702049e-01, 5.77328131e-02, 1.61257148e-01,
       7.71208247e-03, 1.19871464e+01, 3.52410650e+00, 3.78749490e+00,
       1.18086077e-02, 1.56231858e-02, 2.09022313e-01, 1.50261214e-02,
       3.67111713e-01, 1.09428644e-01, 9.21137705e-02, 5.48901260e-01,
       1.08300857e-02, 1.41603783e-01, 3.54739189e-01, 3.64209302e-02,
       2.28841528e-01, 1.26212789e-02, 1.33453846e+00, 1.26478150e-01,
       1.72385767e-01, 9.49962676e-01, 1.47226140e-01, 1.41305253e-02,
       3.61887403e-02, 1.80429548e-01, 5.37590206e-01, 5.65552711e-03,
       1.47275897e-02, 4.16286569e-03, 9.85156279e-03, 2.22502685e+00,
       1.18052907e-01, 3.74823785e-03, 1.30856624e-02, 3.31702468e-04,
       9.90131870e-03, 2.23567467e-02, 1.13359317e-01, 5.48967570e-02,
       5.80479333e-04, 4.97553684e-03, 2.02222407e-01, 1.87080186e-02,
       2.44398370e-01, 4.64383455e-04, 9.45534468e-01, 1.16195373e-01,
       3.56215268e-01, 3.40144277e-01, 2.11460311e-02, 3.18998247e-01,
       3.95853728e-01, 3.42648655e-01, 2.45625675e-02, 2.86425073e-02,
       1.52151912e-01, 1.08300857e-02, 5.25748404e-03, 8.84484649e-02,
       7.43013527e-03, 1.62534206e-03, 4.57749376e-03, 5.02529228e-03,
       2.89576259e-02, 4.55361128e-01, 2.17829004e-01, 6.73024282e-02,
       3.29048857e-02, 7.67891202e-03, 9.87478197e-02, 3.08980849e-02,
       2.64400035e-01, 8.24280642e-03, 5.48967579e-03, 4.83788028e-02,
       9.10523236e-02, 6.35541901e-02, 3.01849246e-02, 1.11949584e-02,
       6.30234694e-03, 1.13702135e+01, 5.30723948e-03, 3.78057867e-01,
       8.08498192e+00, 2.29952738e-01, 1.11349535e+01, 2.56722852e+03,
       2.56722852e+03, 1.05260195e+04, 9.93485229e+02, 6.78959814e+03,
       7.78284851e+02, 8.77557373e+02, 2.37768280e+02, 8.49317566e+02,
       3.40619453e+04, 1.42655518e+04, 1.59933779e+04, 3.80302661e+03,
       1.18842981e+03, 1.18842981e+03, 4.50540125e+05, 3.26316467e+02,
       5.88863159e+02, 5.83842383e+03, 2.74502759e+03, 8.69398359e+04,
       6.50110254e+03, 1.75727676e+04, 1.22178955e+03, 3.79816742e+02,
       1.27937383e+04, 8.67463984e+04, 9.36251562e+04, 3.45371836e+04,
       2.70613501e+03, 7.79440859e+04, 3.08148926e+03, 1.69932578e+04,
       4.41076328e+04, 1.29502167e+02, 2.99547803e+03, 2.86435762e+04,
       1.08400488e+04, 1.05285583e+03, 1.64543877e+01, 2.43704987e+02,
       1.16386017e+02, 6.96177368e+01, 2.59650922e+05, 5.82588281e+03,
       8.49824219e+03, 5.06816315e+02, 2.31048565e+01, 3.46728882e+02,
       6.09845312e+04, 1.00900049e+04, 5.74647461e+03, 9.41348572e+02,
       5.25185205e+03, 1.54792080e+04, 1.90580640e+03, 4.39764688e+04,
       5.01012695e+02, 3.29019453e+04, 6.10297607e+03, 6.05683867e+04,
       1.32646289e+03, 1.03301918e+02, 1.22316162e+03, 4.34801514e+03,
       5.89392578e+02, 3.51316455e+03, 2.45458771e+02, 9.69167419e+02,
       6.43501129e+01, 8.29983902e+00, 4.39479279e+02, 3.60768929e+01,
       1.67203384e+02, 4.33325615e+01, 4.21093292e+01, 1.68316483e+02,
       3.54671021e+03, 7.67620361e+02, 4.69423859e+02, 1.44596634e+02,
       2.21443222e+02, 1.54435168e+03, 3.99273712e+02, 2.30435273e+04,
       2.49411224e+02, 1.32311966e+02, 1.58797666e+04, 6.94506897e+02,
       4.51021436e+03, 1.38390991e+03, 1.37641449e+02, 5.57991371e+01,
       1.38837952e+02, 1.38837952e+02, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 1.92314774e+02, 1.92314774e+02,
       2.97514380e+03, 2.70559540e+02, 2.21820166e+03, 8.49243622e+01,
       3.04869659e+02, 4.01321602e+01, 5.64501839e+01, 3.00085968e+02,
       1.10152740e+02, 1.70358887e+02, 1.95740929e+01, 4.99095752e+03,
       2.36803589e+03, 3.79154736e+03, 5.82359076e+00, 9.97099781e+00,
       1.25597649e+02, 2.35641327e+01, 6.33974731e+02, 1.04250748e+02,
       1.24666061e+02, 8.57109299e+01, 6.05020714e+00, 1.40350479e+02,
       6.06098816e+02, 2.18095612e+02, 3.23314667e+02, 2.16132259e+01,
       1.10519556e+03, 7.34106903e+01, 1.83848541e+02, 3.84862213e+02,
       1.38204441e+01, 3.22100372e+01, 1.18359856e+02, 1.35095840e+02,
       7.34002914e+01, 1.40859234e+00, 5.48119974e+00, 2.08076453e+00,
       3.00514936e+00, 1.88281958e+03, 6.06696510e+01, 2.24886093e+01,
       1.27843332e+01, 1.48530707e-01, 3.88241744e+00, 1.45414230e+02,
       1.08997322e+02, 5.55859108e+01, 2.92611456e+00, 1.60115032e+01,
       7.22688065e+01, 1.78241291e+01, 3.51088104e+02, 1.82565701e+00,
       4.80677948e+02, 1.00757683e+02, 4.29471466e+02, 8.89355927e+01,
       6.18788528e+00, 8.27477264e+01, 7.26450653e+01, 3.77904243e+01,
       2.65888195e+01, 8.26592255e+00, 4.17784843e+01, 3.44163156e+00,
       6.06989324e-01, 2.26212711e+01, 1.57268441e+00, 1.75400925e+00,
       1.75016034e+00, 1.76223469e+00, 8.26951790e+00, 1.37871872e+02,
       4.56675949e+01, 1.87177296e+01, 7.40257263e+00, 3.20871687e+00,
       5.43932152e+01, 8.48197746e+00, 2.49076355e+02, 1.96413612e+01,
       1.42453537e+01, 6.64726486e+01, 2.59304981e+01, 5.30097198e+01,
       5.66508408e+01, 1.13947191e+01, 1.73176098e+00, 4.21188281e+03,
       3.63800526e+00, 1.53504669e+02, 2.46944360e+03, 2.15453888e+02,
       3.99278979e+03])

inputs_std = np.array([6.76610661e+00, 6.76610661e+00, 4.41312164e+02, 5.33424149e+01,
       3.43455383e+02, 1.19708052e+01, 8.04465485e+01, 4.05945158e+00,
       5.61631393e+00, 2.20188475e+00, 8.53577435e-01, 1.98739326e+00,
       1.93457291e-01, 3.01837559e+01, 6.33702040e+00, 2.28878975e+01,
       2.84241915e-01, 1.49925113e-01, 2.12685156e+00, 2.59664595e-01,
       1.99586499e+00, 7.27646112e-01, 1.83744907e+00, 6.61050749e+00,
       3.43783319e-01, 1.15333784e+00, 1.74918365e+00, 3.13866973e-01,
       1.95464540e+00, 1.35418892e-01, 1.77942486e+01, 1.21358490e+00,
       2.04095292e+00, 8.29494762e+00, 6.05936575e+00, 1.38459340e-01,
       4.91612345e-01, 1.10944176e+00, 3.76582837e+00, 1.33705556e-01,
       1.79935530e-01, 1.12370677e-01, 1.39715746e-01, 9.46612453e+00,
       5.24408531e+00, 7.52028227e-02, 2.17285737e-01, 2.07606554e-02,
       3.12660933e-01, 1.71979636e-01, 1.24736774e+00, 1.33180130e+00,
       2.84968503e-02, 1.65302306e-01, 2.88760924e+00, 3.23496938e-01,
       1.75474215e+00, 2.22966447e-02, 2.50082660e+00, 7.75283635e-01,
       3.63631105e+00, 3.48472166e+00, 3.72834742e-01, 3.31627488e+00,
       1.22121296e+01, 1.21736860e+01, 2.41846025e-01, 2.16515675e-01,
       1.11535132e+00, 1.30202860e-01, 2.29367211e-01, 6.65979445e-01,
       2.37840563e-01, 5.24328090e-02, 1.04653716e-01, 8.44168216e-02,
       3.53974611e-01, 4.65158844e+00, 2.43587756e+00, 1.18391097e+00,
       7.95354366e-01, 1.90762341e-01, 2.32128763e+00, 7.34848738e-01,
       1.06894124e+00, 1.12017080e-01, 1.09757468e-01, 4.49252099e-01,
       5.48413336e-01, 5.87224543e-01, 2.75677174e-01, 2.29371682e-01,
       2.42296994e-01, 2.40189266e+01, 8.71945694e-02, 2.68401980e+00,
       2.83152485e+01, 1.00946391e+00, 2.39404469e+01, 1.94786035e+04,
       1.94786035e+04, 8.33924375e+04, 1.28905586e+04, 5.63687227e+04,
       1.21991406e+04, 1.12963486e+04, 2.14020435e+03, 1.68355215e+04,
       3.07735938e+05, 2.06498000e+05, 1.95667750e+05, 9.99363125e+04,
       3.28124062e+04, 3.28124062e+04, 1.09900038e+06, 1.17669521e+04,
       1.27577119e+04, 5.76863945e+04, 6.36399844e+04, 4.69497469e+05,
       5.19896094e+04, 1.75744062e+05, 1.62039512e+04, 1.89456055e+04,
       1.32734844e+05, 4.72343594e+05, 6.33555750e+05, 2.61187031e+05,
       5.32728633e+04, 3.57616000e+05, 2.93104004e+04, 1.99710953e+05,
       3.14267656e+05, 4.55415332e+03, 3.89231211e+04, 2.82736125e+05,
       1.23047312e+05, 7.91261230e+03, 4.54631897e+02, 7.52851562e+03,
       6.64581689e+03, 1.23371021e+03, 8.70016188e+05, 1.13609828e+05,
       1.83128766e+05, 1.46624512e+04, 5.37368945e+03, 2.45194473e+04,
       4.98664500e+05, 1.51421344e+05, 1.03801703e+05, 5.67499375e+04,
       1.35053312e+05, 2.26766438e+05, 6.23958555e+04, 3.17433094e+05,
       3.58450156e+04, 2.84779844e+05, 7.94000703e+04, 4.14347844e+05,
       1.27446475e+04, 2.00173840e+03, 1.18226416e+04, 9.76281250e+04,
       2.70561406e+04, 8.10214922e+04, 4.55539795e+03, 1.30564648e+04,
       1.03184277e+03, 3.74307434e+02, 3.69437549e+03, 1.65382471e+03,
       1.10033037e+04, 1.13456909e+03, 8.33849365e+02, 3.50047949e+03,
       5.81886406e+04, 1.01902188e+04, 1.15497822e+04, 3.22266895e+03,
       1.89876289e+04, 4.67467422e+04, 1.65317539e+04, 2.59856406e+05,
       3.94911548e+03, 3.13047729e+03, 2.48116016e+05, 2.09477461e+04,
       7.19678359e+04, 2.04924219e+04, 3.83144800e+03, 4.71003955e+03,
       5.14836279e+03, 5.14836279e+03, 1.00000000e+00, 1.00000000e+00,
       1.00000000e+00, 1.00000000e+00, 1.38943005e+03, 1.38943005e+03,
       2.49401699e+04, 3.64080664e+03, 1.89017266e+04, 1.34908582e+03,
       4.07049609e+03, 3.55973022e+02, 1.02774133e+03, 2.55217627e+03,
       1.55185632e+03, 1.89885925e+03, 4.35651978e+02, 6.96822656e+03,
       3.20344385e+03, 9.59446973e+03, 1.21423439e+02, 1.25832169e+02,
       9.95452759e+02, 4.29964081e+02, 2.98316870e+03, 6.35841980e+02,
       1.02415796e+03, 8.62331299e+02, 1.68487122e+02, 1.04810645e+03,
       2.51318726e+03, 1.43141846e+03, 2.34984375e+03, 2.90445007e+02,
       5.30021729e+03, 6.38537720e+02, 1.97344958e+03, 1.70653979e+03,
       3.84562592e+02, 3.65560089e+02, 9.32317627e+02, 7.86562073e+02,
       4.63236938e+02, 3.37818260e+01, 8.81202011e+01, 5.66029396e+01,
       4.07316742e+01, 4.58646680e+03, 7.87978882e+02, 4.58406952e+02,
       2.15487030e+02, 1.93688927e+01, 1.27570679e+02, 1.12754810e+03,
       1.03009363e+03, 8.08278748e+02, 1.53378342e+02, 3.35073639e+02,
       7.10969604e+02, 3.06788696e+02, 1.83731287e+03, 1.02956673e+02,
       1.52653516e+03, 7.68771362e+02, 2.28603540e+03, 8.08168823e+02,
       1.10315262e+02, 7.55166687e+02, 1.96053894e+03, 1.85587927e+03,
       3.74026489e+02, 7.77242355e+01, 3.08112946e+02, 4.35739021e+01,
       2.34652615e+01, 1.71881180e+02, 4.90037766e+01, 8.23956070e+01,
       4.16560364e+01, 3.12901249e+01, 1.08605812e+02, 1.87135400e+03,
       4.71441681e+02, 3.82306458e+02, 1.39443802e+02, 1.08204590e+02,
       1.57437866e+03, 1.70332367e+02, 1.10480713e+03, 2.87183929e+02,
       2.82850067e+02, 6.38452759e+02, 2.17634888e+02, 5.02908417e+02,
       5.17192932e+02, 2.14581650e+02, 7.97589340e+01, 5.33265967e+03,
       8.25193710e+01, 8.41679016e+02, 6.28969971e+03, 7.20613037e+02,
       5.27902881e+03])

ohecount_mean  = inputs_mean[:99]
ohearea_mean   = inputs_mean[99:198]
ohelength_mean = inputs_mean[198:]

ohecount_std  = inputs_std[:99]
ohearea_std   = inputs_std[99:198]
ohelength_std = inputs_std[198:]

def normalize_osm_vector_area(x):
    return  (x - ohearea_mean) / ohearea_std

def normalize_osm_vector_count(x):
    return  (x - ohecount_mean) / ohecount_std

def normalize_osm_vector_length(x):
    return  (x - ohelength_mean) / ohelength_std


def unnormalize_osm_vector_area(x, indexes=None):
    if indexes is None:
        r =  x * ohearea_std + ohearea_mean
    else:
        r =  x * ohearea_std[indexes] + ohearea_mean[indexes]
    return r.astype(int)


def unnormalize_osm_vector_count(x, indexes=None):
    if indexes is None:
        r =   x * ohecount_std + ohecount_mean
    else:
        r =   x * ohecount_std[indexes] + ohecount_mean[indexes]
    return r.astype(int)

def unnormalize_osm_vector_length(x, indexes=None):
    if indexes is None:
        r =  x * ohelength_std + ohelength_mean
    else:
        r =  x * ohelength_std[indexes] + ohelength_mean[indexes]
    return r.astype(int)

def unnormalize_osm_vector(x, indexes=None):
    """
    x is a dict with keys 'osm_ohecount', 'osm_ohearea', 'osm_ohelength'
    """
    return {'osm_ohecount':  unnormalize_osm_vector_count(x['osm_ohecount'], indexes),
            'osm_ohearea':   unnormalize_osm_vector_area(x['osm_ohearea'], indexes),
            'osm_ohelength': unnormalize_osm_vector_length(x['osm_ohelength'], indexes)
    }

def signed_mean_substraction(t):
    return np.sign(t) * np.abs(t - embeddings_mean)  

def mean_stdev_norm(t):
    return (t - embeddings_mean)  / embeddings_stdev

def signed_mean_stdev_norm(t):
    return np.sign(t) * np.abs((t - embeddings_mean)  / embeddings_stdev)

def signed_percentile_norm(x):
    xn = np.abs((x - embeddings_percentile_1)/(embeddings_percentile_99-embeddings_percentile_1) ) * np.sign(x)
    return xn     

norm_names = {
    'signed_mean_substraction': signed_mean_substraction,
    'signed_percentile_norm': signed_percentile_norm,
    'mean_stdev_norm': mean_stdev_norm,
    'signed_mean_stdev_norm': signed_mean_stdev_norm

}    

def normalize_embedding(embedding, norm_func_name):
    return norm_names[norm_func_name](embedding)


class ChipMultilabelDataset(Dataset):

    """
    dataset to load chips with multilabel vector
    """

    def __init__(
        self,
        metadata_file: str,
        split: str,
        chips_folder: str = None,
        embeddings_folder: str = None,
        patch_embeddings_folder: str = None,
        chip_transforms = None,
        get_osm_ohecount = False,
        get_osm_ohearea = False,
        get_osm_ohelength = False,
        get_osm_strlabels = False,
        get_esawc_proportions = False,
        get_chip_id = False,
        multilabel_threshold_osm_ohecount = None,
        multilabel_threshold_osm_ohearea = None,
        max_items = None,
        embeddings_normalization = None,
        normalize_input = False,
        cache_size = -1
    ):

        """
        get_osm_strlabels: return also the string description of the multilabels present
        multilabel_threshold_osm_ohecount: returns a 0/1 ohe vector with 1 if the ohe count is > min_ohecount
                       if None, it will return the ohe count
        """

        if sum([multilabel_threshold_osm_ohecount is None, multilabel_threshold_osm_ohearea is None])!=1:
            raise ValueError("must specify exactly one of 'multilabel_threshold_osm_ohearea' or 'multilabel_threshold_osm_ohecount'")

        if embeddings_normalization is not None and not embeddings_normalization in norm_names.keys():
            raise ValueError(f"embeddings_normalization '{embeddings_normalization}' does not exist. only {list(norm_names.keys())} allowed")

        self.split = split
        self.chips_folder = chips_folder
        self.chip_transforms = chip_transforms
        self.embeddings_folder = embeddings_folder
        self.patch_embeddings_folder = patch_embeddings_folder
        self.get_esawc_proportions = get_esawc_proportions
        self.metadata_file = metadata_file
        self.get_chip_id = get_chip_id
        self.get_osm_strlabels = get_osm_strlabels
        self.get_osm_ohearea = get_osm_ohearea
        self.get_osm_ohecount = get_osm_ohecount
        self.get_osm_ohelength = get_osm_ohelength
        self.max_items = max_items
        self.embeddings_normalization = embeddings_normalization
        self.normalize_input = normalize_input
        self.metadata = io.read_multilabel_metadata(metadata_file)
        self.metadata = self.metadata[self.metadata['split']==split]
        self.multilabel_threshold_osm_ohecount = multilabel_threshold_osm_ohecount
        self.multilabel_threshold_osm_ohearea = multilabel_threshold_osm_ohearea
        nitems = len(self.metadata)
        # keep only the items for which there is actually a chip image file
        logger.info(f"checking chip files for {split} split")
        chips_exists = [io.check_chip_exists(chips_folder, embeddings_folder, patch_embeddings_folder, i['col'], i['row']) \
                               for _, i in pbar(self.metadata.iterrows(), max_value=len(self.metadata))]
        self.metadata = self.metadata[chips_exists]
        logger.info(f"read {split} split with {len(self.metadata)} chip files (out of {nitems})")
        
        if max_items is not None:
            self.metadata = self.metadata.iloc[np.random.permutation(len(self.metadata))[:max_items]]
            logger.info(f"limitting to {max_items} items, randomly selected")
        logger.info(f"max cache size is {cache_size}")
        self.cache_size = cache_size
        self.cache = {}

        # so that we can disable chip loading. For instance, we would want to disable it when
        # training with embeddings, and enable it for visualization
        self.disable_chip_loading = False

    def prepare_data(self):
        """This is an optional preprocessing step to be defined in each dataloader.
        It will be called by the Pytorch Lighting Data Module.
        All the preprocessing steps such as normalization or transformations
        might be write in this method when you override it.
        """

    def __len__(self):
        return len(self.metadata)


    def __repr__(self):
        return f"{self.__class__.__name__} {self.split} split with {len(self)} items, in cache {len(self.cache)} items"


    def __getitem__(self, idx):

        if idx in self.cache.keys():
            return self.cache[idx]

        r = {}        

        item = self.metadata.iloc[idx]
        if self.multilabel_threshold_osm_ohecount is not None:
            multilabel = item.onehot_count.astype(int)
            multilabel = (multilabel> self.multilabel_threshold_osm_ohecount).astype(int)

        if self.multilabel_threshold_osm_ohearea is not None:
            # either area or a bit less than squared length
            min_ohe_length = np.sqrt(self.multilabel_threshold_osm_ohearea)*4 / 1.5
            multilabel = (item.onehot_area > self.multilabel_threshold_osm_ohearea) | (item.onehot_length > min_ohe_length)

        r['multilabel'] = torch.tensor(multilabel).type(torch.int8)

        if self.get_chip_id:
            r['chip_id'] = item.name

        if self.chips_folder is not None and not self.disable_chip_loading:
            chip = io.read_chip(self.chips_folder, item['col'], item['row'])
            if self.chip_transforms is not None:
                chip = self.chip_transforms(chip)
            r['chip'] = chip

        if self.embeddings_folder is not None:
            r['embedding'] = io.read_embedding(self.embeddings_folder,  item['col'], item['row']) 
            if self.embeddings_normalization is not None:
                r['embedding'] = normalize_embedding(r['embedding'], self.embeddings_normalization)

        if self.patch_embeddings_folder is not None:
            r['patch_embedding'] = io.read_patch_embedding(self.patch_embeddings_folder,  item['col'], item['row'])

        if self.get_osm_strlabels:
            r['osm_strlabels'] = " ".join(item.string_labels)

        if self.get_osm_ohearea:
            r['osm_ohearea'] = np.r_[item.onehot_area]
            if self.normalize_input:
                r['osm_ohearea'] = normalize_osm_vector_area(r['osm_ohearea'])
                
        if self.get_osm_ohecount:
            r['osm_ohecount'] = np.r_[item.onehot_count]
            if self.normalize_input:
                r['osm_ohecount'] = normalize_osm_vector_count(r['osm_ohecount'])
                
        if self.get_osm_ohelength:
            r['osm_ohelength'] = np.r_[item.onehot_length]
            if self.normalize_input:
                r['osm_ohelength'] = normalize_osm_vector_length(r['osm_ohelength'])
                
        if self.get_esawc_proportions:
            r['esawc_proportions'] = str(item.esawc_proportions)

        # store in cache
        if self.cache_size == -1 or len(self.cache) < self.cache_size:
            self.cache[idx] = r

        return r

    def reset_cache(self):
        self.cache = {}

    def plot_chip_with_tags(self, idx, osm_tags):
        
        if not self.get_chip_id:
            raise ValueError("must set 'get_chip_id' to true in this dataset to plot chips")
        
        if sum(["=" in i for i in osm_tags])!=len(osm_tags):
            raise ValueError("must use '=' in all tags")
        
        # load osm objects
        osm_folder = "/".join(self.embeddings_folder.split("/")[:-1])+"/osm"
        chip_record = self.metadata.iloc[idx]
        chip_id = chip_record.name
        z = gpd.read_parquet(f"{osm_folder}/{chip_id}.parquet")

        # filter tags
        asterix_tags = [i.split("=")[0] for i in osm_tags if i.endswith("=*")]
        regular_tags = {i.split("=")[0]:i.split("=")[1] for i in osm_tags if not i.endswith("=*")}
        
        def hastags(tags, asterix_tags, regular_tags):
            if len(set(tags.keys()).intersection(asterix_tags))>0:
                return True
        
            for k,v in regular_tags.items():
                if k in tags.keys() and v == tags[k]:
                    return True
            return False
        
        zf = z[[hastags(eval(t), asterix_tags, regular_tags) for t in z.tags.values]]
        
        # get chip
        item = self[idx]
        c = item['chip'].numpy()[:3]
        c = np.transpose(c, [1,2,0])
        a,b = np.percentile(c, [5,99])
        c = c *1.0 / b
        c[c>1]=1
        
        # plot chip and geometries
        xy = np.r_[[chip_record.geometry.exterior.xy]][0]
        minlon, minlat = xy.min(axis=1)
        maxlon, maxlat = xy.max(axis=1)
        plt.imshow(c, extent=(minlon, maxlon, minlat, maxlat), alpha=.7)
        
        def plot_geom(geom):
            if 'geoms' in dir(geom):
                for gi in geom.geoms:
                    plot_geom(gi)
            elif 'exterior' in dir(geom):
                plt.plot(*geom.exterior.xy, color="red", alpha=1, lw=2)
            elif 'xy' in dir(geom):
                plt.plot(*geom.xy, color="red", alpha=1, lw=2)
        
        for xgeom in zf.geometry:
            k = plot_geom(xgeom)
        
        plt.axis("off");
        